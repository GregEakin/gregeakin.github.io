(()=>{"use strict";var n={d:(t,e)=>{for(var i in e)n.o(e,i)&&!n.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},t={};n.r(t),n.d(t,{EnrichHandler:()=>f,EnrichedMathDocumentMixin:()=>M,EnrichedMathItemMixin:()=>u,enrichVisitor:()=>p});const e=("undefined"!=typeof window?window:global).MathJax._.components.global,i=(e.GLOBAL,e.isObject,e.combineConfig,e.combineDefaults,e.combineWithMathJax),r=(e.MathJax,MathJax._.core.MathItem),s=(r.protoItem,r.AbstractMathItem,r.STATE),a=r.newState,o=MathJax._.core.MmlTree.SerializedMmlVisitor.SerializedMmlVisitor,c=MathJax._.util.Options,h=(c.isObject,c.APPEND,c.REMOVE,c.OPTIONS,c.Expandable,c.expandable),l=(c.makeArray,c.keys,c.copy,c.insert,c.defaultOptions,c.userOptions,c.selectOptions,c.selectOptionsFromKeys,c.separateOptions,c.lookup,MathJax._.a11y.sre_ts),d=(l.locales,l.setupEngine),m=(l.engineSetup,l.toEnriched);l.parseDOM,l.addPreference,l.fromPreference,l.toPreference,a("ENRICHED",s.COMPILED+10);class p extends o{visitTree(t,e){this.mactionId=0;t=super.visitTree(t);return this.mactionId&&(e.inputData.hasMaction=!0),t}visitHtmlNode(t,e){return t.getSerializedXML()}visitMactionNode(t,e){const[i,n]=0===t.childNodes.length?["",""]:["\n",e],r=this.childNodeMml(t,e+"  ",i);let s=this.getAttributes(t);if("toggle"===t.attributes.get("actiontype")){const e=++this.mactionId;t.setProperty("mactionId",e),s=` data-maction-id="${e}" selection="${t.attributes.get("selection")}"`+s.replace(/ selection="\d+"/,"").replace(/ data-maction-id="\d+"/,"")}return`${e}<maction${s}>`+(r.match(/\S/)?i+r+n:"")+"</maction>"}}function u(t,r,e){return class extends t{constructor(){super(...arguments),this.toMathML=e}serializeMml(t){if("outerHTML"in t)return t.outerHTML;if("undefined"!=typeof Element&&"undefined"!=typeof window&&t instanceof Element){const e=window.document.createElement("div");return e.appendChild(t),e.innerHTML}return t.toString()}enrich(e,t=!1){if(!(this.state()>=s.ENRICHED)){if(!this.isEscaped&&(e.options.enableEnrichment||t)){const t=new e.options.MathItem("",r);try{var i=this.inputData.originalMml?this.adjustSelections():this.inputData.originalMml=this.toMathML(this.root,this),n=m(i);this.inputData.enrichedMml=t.math=this.serializeMml(n),t.math=t.math.replace(/ role="treeitem"/g,' data-speech-node="true"').replace(/ aria-(?:posinset|owns|setsize)=".*?"/g,""),t.display=this.display,t.compile(e),this.root=t.root}catch(t){e.options.enrichError(e,this,t)}}this.state(s.ENRICHED)}}toEnriched(t){return this.serializeMml(m(t))}unEnrich(t){var e=this.inputData.originalMml;if(e){const i=new t.options.MathItem("",r);i.math=e,i.display=this.display,i.compile(t),this.root=i.root}}adjustSelections(){const t=this.inputData.originalMml;if(!this.inputData.hasMaction)return t;const n=[];return this.root.walkTree(t=>{t.isKind("maction")&&(n[t.attributes.get("data-maction-id")]=t)}),t.replace(/(data-maction-id="(\d+)" selection=)"\d+"/g,(t,e,i)=>`${e}"${n[i].attributes.get("selection")}"`)}}}function M(t,n){var e;return(e=class extends t{constructor(...t){super(...t),n.setMmlFactory(this.mmlFactory);const e=this.constructor.ProcessBits,i=(e.has("enriched")||e.allocate("enriched"),new p(this.mmlFactory));this.options.MathItem=u(this.options.MathItem,n,(t,e)=>i.visitTree(t,e))}enrich(){if(!this.processed.isSet("enriched")){if(this.options.enableEnrichment){d(this.options.sre);for(const t of this.math)t.enrich(this)}this.processed.set("enriched")}return this}enrichError(t,e,i){console.warn("Enrichment error:",i)}state(t,e=!1){if(super.state(t,e),t<s.ENRICHED&&(this.processed.clear("enriched"),t>=s.COMPILED))for(const t of this.math)t.unEnrich(this);return this}}).OPTIONS=Object.assign(Object.assign({},t.OPTIONS),{enableEnrichment:!0,enrichError:(t,e,i)=>t.enrichError(t,e,i),renderActions:h(Object.assign(Object.assign({},t.OPTIONS.renderActions),{enrich:[s.ENRICHED]})),sre:h({speech:"none",locale:"en",domain:"clearspeak",style:"default",braille:"nemeth",structure:!0,aria:!0})}),e}function f(t,e){return e.setAdaptor(t.adaptor),t.documentClass=M(t.documentClass,e),t}MathJax.loader&&MathJax.loader.checkVersion("a11y/semantic-enrich","4.0.0","a11y"),i({_:{a11y:{"semantic-enrich":t}}});const E=MathJax._.input.mathml_ts.MathML;MathJax.startup&&MathJax.startup.extendHandler(t=>f(t,new E({allowHtmlInTokenNodes:!0})))})();
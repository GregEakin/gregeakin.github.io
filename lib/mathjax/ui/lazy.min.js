(()=>{"use strict";var a={d:(t,e)=>{for(var s in e)a.o(e,s)&&!a.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},t={};a.r(t),a.d(t,{LAZYID:()=>c,LazyHandler:()=>d,LazyList:()=>h,LazyMathDocumentMixin:()=>u,LazyMathItemMixin:()=>z});const e=("undefined"!=typeof window?window:global).MathJax._.components.global,s=(e.GLOBAL,e.isObject,e.combineConfig,e.combineDefaults,e.combineWithMathJax),i=(e.MathJax,MathJax._.core.MathItem),r=(i.protoItem,i.AbstractMathItem,i.STATE),l=i.newState,n=MathJax._.util.Retries,o=n.handleRetriesFor;n.retryAfter;var y=function(t,l,n,o){return new(n=n||Promise)(function(s,e){function a(t){try{r(o.next(t))}catch(t){e(t)}}function i(t){try{r(o.throw(t))}catch(t){e(t)}}function r(t){var e;t.done?s(t.value):((e=t.value)instanceof n?e:new n(function(t){t(e)})).then(a,i)}r((o=o.apply(t,l||[])).next())})};class h{constructor(){this.id=0,this.items=new Map}add(t){var e=String(this.id++);return this.items.set(e,t),e}get(t){return this.items.get(t)}delete(t){return this.items.delete(t)}}l("LAZYALWAYS",r.FINDMATH+3);const c="data-mjx-lazy";function z(t){return class extends t{constructor(...t){super(...t),this.lazyCompile=!0,this.lazyTypeset=!0,this.lazyTex=!1,this.attachSpeech=t=>{var e;this.state()>=r.ATTACHSPEECH||(this.lazyTypeset||null==(e=super.attachSpeech)||e.call(this,t),this.state(r.ATTACHSPEECH))},this.end.node||(this.lazyCompile=this.lazyTypeset=!1)}compile(t){this.lazyCompile?this.state()<r.COMPILED&&(this.lazyTex="TeX"===this.inputJax.name,this.root=t.mmlFactory.create("math"),this.state(r.COMPILED)):super.compile(t)}state(t=null,e=!1){return null!==e&&super.state(t,e),super.state()}typeset(t){if(this.lazyTypeset){if(this.state()<r.TYPESET){const s=t.adaptor;var e;this.lazyMarker||(e=t.lazyList.add(this),this.lazyMarker=s.node("mjx-lazy",{[c]:e}),this.typesetRoot=s.node("mjx-container",{},[this.lazyMarker])),this.state(r.TYPESET)}}else super.typeset(t)}updateDocument(t){super.updateDocument(t),this.lazyTypeset&&t.lazyObserver.observe(this.lazyMarker)}}}function u(t){var e;return(e=class extends t{constructor(...t){super(...t),this.lazyAlwaysContainers=null,this.lazyAlwaysIndex=0,this.lazyPromise=Promise.resolve(),this.lazyIdle=!1,this.lazySet=new Set,this.options.MathItem=z(this.options.MathItem);const e=this.constructor.ProcessBits,s=(e.has("lazyAlways")||e.allocate("lazyAlways"),this.lazyObserver=new IntersectionObserver(this.lazyObserve.bind(this),{rootMargin:this.options.lazyMargin}),this.lazyList=new h,this.lazyHandleSet.bind(this));if(this.lazyProcessSet=window&&window.requestIdleCallback?()=>window.requestIdleCallback(s):()=>setTimeout(s,10),window){let t=!1;const e=()=>{t||this.lazyTypesetAll(),t=!0};window.matchMedia("print").addListener(e),window.addEventListener("beforeprint",e)}}lazyAlways(){if(this.lazyAlwaysContainers&&!this.processed.isSet("lazyAlways")){for(const t of this.math){const e=t;e.lazyTypeset&&this.lazyIsAlways(e)&&(e.lazyCompile=e.lazyTypeset=!1)}this.processed.set("lazyAlways")}}lazyIsAlways(t){if(t.state()<r.LAZYALWAYS){t.state(r.LAZYALWAYS);const e=t.start.node,s=this.adaptor,a=this.lazyAlwaysIndex,i=this.lazyAlwaysContainers.length;do{const t=this.lazyAlwaysContainers[this.lazyAlwaysIndex];if(s.contains(t,e))return!0}while(++this.lazyAlwaysIndex>=i&&(this.lazyAlwaysIndex=0),this.lazyAlwaysIndex!==a)}return!1}state(t,e=!1){return super.state(t,e),t<r.LAZYALWAYS&&this.processed.clear("lazyAlways"),this}lazyTypesetAll(){return y(this,void 0,void 0,function*(){let t=r.LAST;for(const e of this.math){const s=e;(s.lazyCompile||s.lazyTypeset)&&(s.lazyCompile?(s.state(r.COMPILED-1),t=r.COMPILED):(s.state(r.TYPESET-1),r.TYPESET<t&&(t=r.TYPESET)),s.lazyCompile=s.lazyTypeset=!1,s.lazyMarker&&this.lazyObserver.unobserve(s.lazyMarker))}if(t===r.LAST)return Promise.resolve();this.state(t-1,null);const e=this.outputJax.options.fontCache;return e&&(this.outputJax.options.fontCache="none"),this.reset(),o(()=>this.render()).then(()=>{e&&(this.outputJax.options.fontCache=e)})})}lazyObserve(t){for(const e of t){const t=this.adaptor.getAttribute(e.target,c);this.lazyList.get(t)&&(e.isIntersecting?(this.lazySet.add(t),this.lazyIdle||(this.lazyIdle=!0,this.lazyProcessSet())):this.lazySet.delete(t))}}lazyHandleSet(){const e=this.lazySet;this.lazySet=new Set,this.lazyPromise=this.lazyPromise.then(()=>{var t=this.compileEarlierItems(e)?r.COMPILED:r.TYPESET,t=this.resetStates(e,t);return this.state(t-1,null),o(()=>{this.render(),this.lazyIdle=!1})})}resetStates(t,e){for(const s of t.values()){const t=this.lazyList.get(s);t.lazyCompile?(t.state(r.COMPILED-1),e=r.COMPILED):Object.hasOwn(t.metrics,"em")?t.state(r.TYPESET-1):(t.state(r.METRICS-1),e=r.METRICS),t.lazyCompile=t.lazyTypeset=!1,t.lazyMarker&&this.lazyObserver.unobserve(t.lazyMarker)}return e}compileEarlierItems(t){var e=this.earliestTex(t);if(!e)return!1;let s=!1;for(const t of this.math){const a=t;if(a===e||null==a||!a.lazyCompile||!a.lazyTex)break;a.lazyCompile=!1,a.lazyMarker&&this.lazyObserver.unobserve(a.lazyMarker),a.state(r.COMPILED-1),s=!0}return s}earliestTex(t){let e=null,s=null;for(const a of t.values()){const t=this.lazyList.get(a);t.lazyTex&&(null===e||parseInt(a)<e)&&(e=parseInt(a),s=t)}return s}clearMathItemsWithin(t){const e=super.clearMathItemsWithin(t);for(const t of e){const e=t.lazyMarker;e&&(this.lazyObserver.unobserve(e),this.lazyList.delete(this.adaptor.getAttribute(e,c)))}return e}render(){var t=this.options.lazyAlwaysTypeset;return this.lazyAlwaysContainers=t?this.adaptor.getElements(Array.isArray(t)?t:[t],this.document):null,this.lazyAlwaysIndex=0,super.render(),this}}).OPTIONS=Object.assign(Object.assign({},t.OPTIONS),{lazyMargin:"500px",lazyAlwaysTypeset:null,renderActions:Object.assign(Object.assign({},t.OPTIONS.renderActions),{lazyAlways:[r.LAZYALWAYS,"lazyAlways","",!1]})}),e}function d(t){return"undefined"!=typeof IntersectionObserver&&(t.documentClass=u(t.documentClass)),t}MathJax.loader&&MathJax.loader.checkVersion("ui/lazy","4.0.0","ui"),s({_:{ui:{lazy:{LazyHandler:t}}}}),MathJax.startup&&MathJax.startup.extendHandler(t=>d(t))})();
(()=>{"use strict";var s,t,i={d:(t,e)=>{for(var s in e)i.o(e,s)&&!i.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={},_=(i.r(e),i.d(e,{MJContextMenu:()=>y}),{}),U=(i.r(_),i.d(_,{clearspeakMenu:()=>wt,localeMenu:()=>Tt}),{}),J=(i.r(U),i.d(U,{copyToClipboard:()=>w,isMac:()=>O}),{}),B=(i.r(J),i.d(J,{annotation:()=>I,copyAnnotations:()=>Dt,showAnnotations:()=>Nt}),{}),H=(i.r(B),i.d(B,{RadioCompare:()=>Jt}),{}),V=(i.r(H),i.d(H,{MmlVisitor:()=>Bt}),{}),F=(i.r(V),i.d(V,{SelectableInfo:()=>D}),{}),j=(i.r(F),i.d(F,{Menu:()=>P}),{});i.r(j),i.d(j,{MenuHandler:()=>jt,MenuMathDocumentMixin:()=>Ft,MenuMathItemMixin:()=>Vt});const n=("undefined"!=typeof window?window:global).MathJax._.components.global,G=(n.GLOBAL,n.isObject,n.combineConfig,n.combineDefaults,n.combineWithMathJax),z=n.MathJax;(t=s=s||{})[t.RETURN=13]="RETURN",t[t.ESCAPE=27]="ESCAPE",t[t.SPACE=32]="SPACE",t[t.LEFT=37]="LEFT",t[t.UP=38]="UP",t[t.RIGHT=39]="RIGHT",t[t.DOWN=40]="DOWN";class K extends class{constructor(){this.bubble=!1}bubbleKey(){this.bubble=!0}keydown(t){switch(t.keyCode){case s.ESCAPE:this.escape(t);break;case s.RIGHT:this.right(t);break;case s.LEFT:this.left(t);break;case s.UP:this.up(t);break;case s.DOWN:this.down(t);break;case s.RETURN:case s.SPACE:this.space(t);break;default:return}this.bubble?this.bubble=!1:this.stop(t)}escape(t){}space(t){}left(t){}right(t){}up(t){}down(t){}stop(t){t&&(t.stopPropagation(),t.preventDefault(),t.cancelBubble=!0)}mousedown(t){return this.stop(t)}mouseup(t){return this.stop(t)}mouseover(t){return this.stop(t)}mouseout(t){return this.stop(t)}click(t){return this.stop(t)}addEvents(t){t.addEventListener("mousedown",this.mousedown.bind(this)),t.addEventListener("mouseup",this.mouseup.bind(this)),t.addEventListener("mouseover",this.mouseover.bind(this)),t.addEventListener("mouseout",this.mouseout.bind(this)),t.addEventListener("click",this.click.bind(this)),t.addEventListener("keydown",this.keydown.bind(this)),t.addEventListener("dragstart",this.stop.bind(this)),t.addEventListener("selectstart",this.stop.bind(this)),t.addEventListener("contextmenu",this.stop.bind(this)),t.addEventListener("dblclick",this.stop.bind(this))}}{addAttributes(t){for(const e in t)this.html.setAttribute(e,t[e])}get html(){return this._html||this.generateHtml(),this._html}set html(t){this._html=t,this.addEvents(t)}generateHtml(){const t=document.createElement("div");t.classList.add(this.className),t.setAttribute("role",this.role),this.html=t}focus(){const t=this.html;t.setAttribute("tabindex","0"),t.focus()}unfocus(){const t=this.html;t.hasAttribute("tabindex")&&t.setAttribute("tabindex","-1");try{t.blur()}catch(t){}t.blur()}}class X extends K{constructor(){super(...arguments),this.posted=!1}isPosted(){return this.posted}post(t,e){this.posted||(void 0!==t&&void 0!==e&&this.html.setAttribute("style","left: "+t+"px; top: "+e+"px;"),this.display(),this.posted=!0)}unpost(){if(this.posted){const t=this.html;t.parentNode&&t.parentNode.removeChild(t),this.posted=!1}}}function o(t){return"CtxtMenu_"+t}const a={ATTACHED:o("Attached"),CONTEXTMENU:o("ContextMenu"),MENU:o("Menu"),MENUARROW:o("MenuArrow"),MENUACTIVE:o("MenuActive"),MENUCHECK:o("MenuCheck"),MENUCLOSE:o("MenuClose"),MENUCOMBOBOX:o("MenuComboBox"),MENUDISABLED:o("MenuDisabled"),MENUFRAME:o("MenuFrame"),MENUITEM:o("MenuItem"),MENULABEL:o("MenuLabel"),MENURADIOCHECK:o("MenuRadioCheck"),MENUINPUTBOX:o("MenuInputBox"),MENURULE:o("MenuRule"),MENUSLIDER:o("MenuSlider"),MOUSEPOST:o("MousePost"),RTL:o("RTL"),INFO:o("Info"),INFOCLOSE:o("InfoClose"),INFOCONTENT:o("InfoContent"),INFOSIGNATURE:o("InfoSignature"),INFOTITLE:o("InfoTitle"),SLIDERVALUE:o("SliderValue"),SLIDERBAR:o("SliderBar"),SELECTION:o("Selection"),SELECTIONBOX:o("SelectionBox"),SELECTIONMENU:o("SelectionMenu"),SELECTIONDIVIDER:o("SelectionDivider"),SELECTIONITEM:o("SelectionItem")},r={COUNTER:o("Counter"),KEYDOWNFUNC:o("keydownFunc"),CONTEXTMENUFUNC:o("contextmenuFunc"),OLDTAB:o("Oldtabindex"),TOUCHFUNC:o("TouchFunc")};class W extends K{constructor(t,e){super(),this._menu=t,this._type=e,this.className=a.MENUITEM,this.role="menuitem",this.hidden=!1}get menu(){return this._menu}set menu(t){this._menu=t}get type(){return this._type}hide(){this.hidden=!0,this.menu.generateMenu()}show(){this.hidden=!1,this.menu.generateMenu()}isHidden(){return this.hidden}}function l(t){const e=t.menu;(e.baseMenu||e).unpost()}function h(t){t=t.menu;return(t.baseMenu||t).store.active}function u(t,e){console.error("ContextMenu Error: "+e)}let c=0;class d extends W{constructor(t,e,s,i){super(t,e),this._content=s,this.disabled=!1,this.callbacks=[],this._id=i||s}get content(){return this._content}set content(t){this._content=t,this.generateHtml(),this.menu&&this.menu.generateHtml()}get id(){return this._id}press(){this.disabled||(this.executeAction(),this.executeCallbacks_())}executeAction(){}registerCallback(t){-1===this.callbacks.indexOf(t)&&this.callbacks.push(t)}unregisterCallback(t){t=this.callbacks.indexOf(t);-1!==t&&this.callbacks.splice(t,1)}mousedown(t){this.press(),this.stop(t)}mouseover(t){this.focus(),this.stop(t)}mouseout(t){this.deactivate(),this.stop(t)}generateHtml(){super.generateHtml();const t=this.html;t.setAttribute("aria-disabled","false"),t.textContent=this.content}activate(){this.disabled||this.html.classList.add(a.MENUACTIVE)}deactivate(){this.html.classList.remove(a.MENUACTIVE)}focus(){this.menu.focused=this,super.focus(),this.activate()}unfocus(){this.deactivate(),super.unfocus()}escape(t){l(this)}up(t){this.menu.up(t)}down(t){this.menu.down(t)}left(t){this.menu.left(t)}right(t){this.menu.right(t)}space(t){this.press()}disable(){this.disabled=!0;const t=this.html;t.classList.add(a.MENUDISABLED),t.setAttribute("aria-disabled","true")}enable(){this.disabled=!1;const t=this.html;t.classList.remove(a.MENUDISABLED),t.removeAttribute("aria-disabled")}executeCallbacks_(){for(const t of this.callbacks)try{t(this)}catch(t){u(0,"Callback for menu entry "+this.id+" failed.")}}}class m extends d{static fromJson(t,{content:e,menu:s,id:i},n){const o=new this(n,e,i),a=t.get("subMenu")(t,s,o);return o.submenu=a,o}constructor(t,e,s){super(t,"submenu",e,s),this._submenu=null}set submenu(t){this._submenu=t}get submenu(){return this._submenu}mouseover(t){this.focus(),this.stop(t)}mouseout(t){this.stop(t)}unfocus(){if(this.submenu.isPosted()){if(this.menu.focused!==this)return super.unfocus(),void this.menu.unpostSubmenus();this.html.setAttribute("tabindex","-1"),this.html.blur()}else super.unfocus()}focus(){super.focus(),this.submenu.isPosted()||this.disabled||this.submenu.post()}executeAction(){this.submenu.isPosted()?this.submenu.unpost():this.submenu.post()}generateHtml(){super.generateHtml();const t=this.html;this.span=document.createElement("span"),this.span.textContent="►",this.span.classList.add(a.MENUARROW),t.appendChild(this.span),t.setAttribute("aria-haspopup","true")}left(t){this.submenu.isPosted()?this.submenu.unpost():super.left(t)}right(t){this.submenu.isPosted()?this.submenu.down(t):this.submenu.post()}toJson(){return{type:""}}}class q extends X{constructor(){super(...arguments),this.className=a.CONTEXTMENU,this.role="menu",this._items=[],this._baseMenu=null}set baseMenu(t){this._baseMenu=t}get baseMenu(){return this._baseMenu}get items(){return this._items}set items(t){this._items=t}get pool(){return this.variablePool}get focused(){return this._focused}set focused(t){if(this._focused!==t){this._focused||this.unfocus();const e=this._focused;this._focused=t,e&&e.unfocus()}}up(t){const e=this.items.filter(t=>t instanceof d&&!t.isHidden());if(0!==e.length)if(this.focused){let t=e.indexOf(this.focused);-1!==t&&(t=t?--t:e.length-1,e[t].focus())}else e[e.length-1].focus()}down(t){const e=this.items.filter(t=>t instanceof d&&!t.isHidden());if(0!==e.length)if(this.focused){let t=e.indexOf(this.focused);-1!==t&&(t=++t===e.length?0:t,e[t].focus())}else e[0].focus()}generateHtml(){super.generateHtml(),this.generateMenu()}generateMenu(){const t=this.html;t.classList.add(a.MENU);for(const e of this.items)if(e.isHidden()){const s=e.html;s.parentNode&&s.parentNode.removeChild(s)}else t.appendChild(e.html)}post(t,e){this.variablePool.update(),super.post(t,e)}unpostSubmenus(){for(const t of this.items.filter(t=>t instanceof m))t.submenu.unpost(),t!==this.focused&&t.unfocus()}unpost(){super.unpost(),this.unpostSubmenus(),this.focused=null}find(t){for(const s of this.items)if("rule"!==s.type){if(s.id===t)return s;if("submenu"===s.type){var e=s.submenu.find(t);if(e)return e}}return null}}class ${constructor(t){this.menu=t,this.store=[],this._active=null,this.counter=0,this.attachedClass=a.ATTACHED+"_"+c++,this.taborder=!0,this.attrMap={}}set active(t){do{if(-1!==this.store.indexOf(t)){this._active=t;break}}while(t=t.parentNode)}get active(){return this._active}next(){var t=this.store.length;if(0===t)return this.active=null;let e=this.store.indexOf(this.active);return e=-1!==e&&e<t-1?e+1:0,this.active=this.store[e],this.active}previous(){var t=this.store.length;if(0===t)return this.active=null;t-=1;let e=this.store.indexOf(this.active);return e=-1===e||0===e?t:e-1,this.active=this.store[e],this.active}clear(){this.remove(this.store)}insert(t){var e=t instanceof HTMLElement?[t]:t;for(const t of e)this.insertElement(t);this.sort()}remove(t){var e=t instanceof HTMLElement?[t]:t;for(const t of e)this.removeElement(t);this.sort()}inTaborder(t){this.taborder&&!t&&this.removeTaborder(),!this.taborder&&t&&this.insertTaborder(),this.taborder=t}insertTaborder(){this.taborder&&this.insertTaborder_()}removeTaborder(){this.taborder&&this.removeTaborder_()}insertElement(t){t.classList.contains(this.attachedClass)||(t.classList.add(this.attachedClass),this.taborder&&this.addTabindex(t),this.addEvents(t))}removeElement(t){t.classList.contains(this.attachedClass)&&(t.classList.remove(this.attachedClass),this.taborder&&this.removeTabindex(t),this.removeEvents(t))}sort(){var t=document.getElementsByClassName(this.attachedClass);this.store=[].slice.call(t)}insertTaborder_(){this.store.forEach(t=>t.setAttribute("tabindex","0"))}removeTaborder_(){this.store.forEach(t=>t.setAttribute("tabindex","-1"))}addTabindex(t){t.hasAttribute("tabindex")&&t.setAttribute(r.OLDTAB,t.getAttribute("tabindex")),t.setAttribute("tabindex","0")}removeTabindex(t){t.hasAttribute(r.OLDTAB)?(t.setAttribute("tabindex",t.getAttribute(r.OLDTAB)),t.removeAttribute(r.OLDTAB)):t.removeAttribute("tabindex")}addEvents(t){t.hasAttribute(r.COUNTER)||(this.addEvent(t,"contextmenu",this.menu.post.bind(this.menu)),this.addEvent(t,"keydown",this.keydown.bind(this)),t.setAttribute(r.COUNTER,this.counter.toString()),this.counter++)}addEvent(t,e,s){var i=r[e.toUpperCase()+"FUNC"];this.attrMap[i+this.counter]=s,t.addEventListener(e,s)}removeEvents(t){var e;t.hasAttribute(r.COUNTER)&&(e=t.getAttribute(r.COUNTER),this.removeEvent(t,"contextmenu",e),this.removeEvent(t,"keydown",e),t.removeAttribute(r.COUNTER))}removeEvent(t,e,s){var i=r[e.toUpperCase()+"FUNC"],i=this.attrMap[i+s];t.removeEventListener(e,i)}keydown(t){t.keyCode===s.SPACE&&(this.menu.post(t),t.preventDefault(),t.stopImmediatePropagation())}}class Z{constructor(){this.pool={}}insert(t){this.pool[t.name]=t}lookup(t){return this.pool[t]}remove(t){delete this.pool[t]}update(){for(const t in this.pool)this.pool[t].update()}}class Y extends q{static fromJson(e,{pool:t,items:s,id:i=""}){const n=new this(e),o=(n.id=i,e.get("variable"));t.forEach(t=>o(e,t,n.pool));i=e.get("items")(e,s,n);return n.items=i,n}constructor(t){super(),this.factory=t,this.id="",this.moving=!1,this._store=new $(this),this.widgets=[],this.variablePool=new Z}generateHtml(){this.isPosted()&&this.unpost(),super.generateHtml(),this._frame=document.createElement("div"),this._frame.classList.add(a.MENUFRAME);var t="left: 0px; top: 0px; z-index: 200; width: 100%; height: 100%; border: 0px; padding: 0px; margin: 0px;";this._frame.setAttribute("style","position: absolute; "+t);const e=document.createElement("div");e.setAttribute("style","position: fixed; "+t),this._frame.appendChild(e),e.addEventListener("mousedown",function(t){this.unpost(),this.unpostWidgets(),this.stop(t)}.bind(this))}display(){document.body.appendChild(this.frame),this.frame.appendChild(this.html),this.focus()}escape(t){this.unpost(),this.unpostWidgets()}unpost(){if(super.unpost(),!(0<this.widgets.length)){this.frame.parentNode.removeChild(this.frame);const t=this.store;this.moving||t.insertTaborder(),t.active.focus()}}left(t){this.move_(this.store.previous())}right(t){this.move_(this.store.next())}get frame(){return this._frame}get store(){return this._store}post(t,e){if(void 0!==e)return this.moving||this.store.removeTaborder(),void super.post(t,e);const s=t;let i,n,o;if(s instanceof Event?(i=s.target,this.stop(s)):i=s,s instanceof MouseEvent&&(n=s.pageX,o=s.pageY,n||o||!s.clientX||(n=s.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,o=s.clientY+document.body.scrollTop+document.documentElement.scrollTop)),!n&&!o&&i){const t=window.pageXOffset||document.documentElement.scrollLeft,e=window.pageYOffset||document.documentElement.scrollTop,s=i.getBoundingClientRect();n=(s.right+s.left)/2+t,o=(s.bottom+s.top)/2+e}this.store.active=i,this.anchor=this.store.active;e=this.html;n+e.offsetWidth>document.body.offsetWidth-5&&(n=document.body.offsetWidth-e.offsetWidth-5),this.post(n,o)}registerWidget(t){this.widgets.push(t)}unregisterWidget(t){t=this.widgets.indexOf(t);-1<t&&this.widgets.splice(t,1),0===this.widgets.length&&this.unpost()}unpostWidgets(){this.widgets.forEach(t=>t.unpost())}toJson(){return{type:""}}move_(t){this.anchor&&t!==this.anchor&&(this.moving=!0,this.unpost(),this.post(t),this.moving=!1)}}class Q extends q{static fromJson(t,{items:e},s){const i=new this(s),n=t.get("items")(t,e,i);return i.items=n,i}constructor(t){super(),this._anchor=t,this.variablePool=this.anchor.menu.pool,this.setBaseMenu()}get anchor(){return this._anchor}post(){if(this.anchor.menu.isPosted()){let t=this.anchor.html;var i=this.html,n=this.baseMenu.frame,o=t.offsetWidth;let e=o-2,s=0;for(;t&&t!==n;)e+=t.offsetLeft,s+=t.offsetTop,t=t.parentNode;e+i.offsetWidth>document.body.offsetWidth-5&&(e=Math.max(5,e-o-i.offsetWidth+6)),super.post(e,s)}}display(){this.baseMenu.frame.appendChild(this.html)}setBaseMenu(){let t=this;for(;(t=t.anchor.menu)instanceof Q;);this.baseMenu=t}left(t){this.focused=null,this.anchor.focus()}toJson(){return{type:""}}}class tt extends X{constructor(t){super(),this.element=t,this.className=a.MENUCLOSE,this.role="button"}generateHtml(){const t=document.createElement("span"),e=(t.classList.add(this.className),t.setAttribute("role",this.role),t.setAttribute("tabindex","0"),document.createElement("span"));e.textContent="×",t.appendChild(e),this.html=t}display(){}unpost(){super.unpost(),this.element.unpost()}keydown(t){this.bubbleKey(),super.keydown(t)}space(t){this.unpost(),this.stop(t)}mousedown(t){this.unpost(),this.stop(t)}}class p extends X{constructor(t,e,s){super(),this.title=t,this.signature=s,this.className=a.INFO,this.role="dialog",this.contentDiv=this.generateContent(),this.close=this.generateClose(),this.content=e||function(){return""}}attachMenu(t){this.menu=t}generateHtml(){super.generateHtml();const t=this.html;t.appendChild(this.generateTitle()),t.appendChild(this.contentDiv),t.appendChild(this.generateSignature()),t.appendChild(this.close.html),t.setAttribute("tabindex","0")}post(){super.post();const t=document.documentElement,e=this.html,s=window.innerHeight||t.clientHeight||t.scrollHeight||0,i=Math.floor(-e.offsetWidth/2),n=Math.floor((s-e.offsetHeight)/3);e.setAttribute("style","margin-left: "+i+"px; top: "+n+"px;"),window.event instanceof MouseEvent&&e.classList.add(a.MOUSEPOST),e.focus()}display(){this.menu.registerWidget(this),this.contentDiv.innerHTML=this.content();const t=this.menu.html;t.parentNode&&t.parentNode.removeChild(t),this.menu.frame.appendChild(this.html)}click(t){}keydown(t){this.bubbleKey(),super.keydown(t)}escape(t){this.unpost()}unpost(){super.unpost(),this.html.classList.remove(a.MOUSEPOST),this.menu.unregisterWidget(this)}generateClose(){const t=new tt(this),e=t.html;return e.classList.add(a.INFOCLOSE),e.setAttribute("aria-label","Close Dialog Box"),t}generateTitle(){const t=document.createElement("span");return t.innerHTML=this.title,t.classList.add(a.INFOTITLE),t}generateContent(){const t=document.createElement("div");return t.classList.add(a.INFOCONTENT),t.setAttribute("tabindex","0"),t}generateSignature(){const t=document.createElement("span");return t.innerHTML=this.signature,t.classList.add(a.INFOSIGNATURE),t}toJson(){return{type:""}}}class b extends d{generateHtml(){super.generateHtml();const t=this.html;this.span||this.generateSpan(),t.appendChild(this.span),this.update()}register(){this.variable.register(this)}unregister(){this.variable.unregister(this)}update(){this.updateAria(),this.span&&this.updateSpan()}}class et extends b{static fromJson(t,{content:e,variable:s,id:i},n){return new this(n,e,s,i)}constructor(t,e,s,i){super(t,"radio",e,i),this.role="menuitemradio",this.variable=t.pool.lookup(s),this.register()}executeAction(){this.variable.setValue(this.id),l(this)}generateSpan(){this.span=document.createElement("span"),this.span.textContent="✓",this.span.classList.add(a.MENURADIOCHECK)}updateAria(){this.html.setAttribute("aria-checked",this.variable.getValue()===this.id?"true":"false")}updateSpan(){this.span.style.display=this.variable.getValue()===this.id?"":"none"}toJson(){return{type:""}}}class st extends W{static fromJson(t,e,s){return new this(s)}constructor(t){super(t,"rule"),this.className=a.MENUITEM,this.role="separator"}generateHtml(){super.generateHtml();const t=this.html;t.classList.add(a.MENURULE),t.setAttribute("aria-orientation","vertical")}addEvents(t){}toJson(){return{type:"rule"}}}class it extends d{static fromJson(t,{content:e,action:s,id:i},n){return new this(n,e,s,i)}constructor(t,e,s,i){super(t,"command",e,i),this.command=s}executeAction(){try{this.command(h(this))}catch(t){u(0,"Illegal command callback.")}l(this)}toJson(){return{type:""}}}class nt{static fromJson(t,{name:e,getter:s,setter:i},n){e=new this(e,s,i);n.insert(e)}constructor(t,e,s){this._name=t,this.getter=e,this.setter=s,this.items=[]}get name(){return this._name}getValue(t){try{return this.getter(t)}catch(t){return u(0,"Command of variable "+this.name+" failed."),null}}setValue(t,e){try{this.setter(t,e)}catch(t){u(0,"Command of variable "+this.name+" failed.")}this.update()}register(t){-1===this.items.indexOf(t)&&this.items.push(t)}unregister(t){t=this.items.indexOf(t);-1!==t&&this.items.splice(t,1)}update(){this.items.forEach(t=>t.update())}registerCallback(e){this.items.forEach(t=>t.registerCallback(e))}unregisterCallback(e){this.items.forEach(t=>t.unregisterCallback(e))}toJson(){return{type:"variable",name:this.name,getter:this.getter.toString(),setter:this.setter.toString()}}}class ot extends b{static fromJson(t,{content:e,variable:s,id:i},n){return new this(n,e,s,i)}constructor(t,e,s,i){super(t,"checkbox",e,i),this.role="menuitemcheckbox",this.variable=t.pool.lookup(s),this.register()}executeAction(){this.variable.setValue(!this.variable.getValue()),l(this)}generateSpan(){this.span=document.createElement("span"),this.span.textContent="✓",this.span.classList.add(a.MENUCHECK)}updateAria(){this.html.setAttribute("aria-checked",this.variable.getValue()?"true":"false")}updateSpan(){this.span.style.display=this.variable.getValue()?"":"none"}toJson(){return{type:""}}}class at extends b{static fromJson(t,{content:e,variable:s,id:i},n){return new this(n,e,s,i)}constructor(t,e,s,i){super(t,"combobox",e,i),this.role="combobox",this.inputEvent=!1,this.variable=t.pool.lookup(s),this.register()}executeAction(){this.variable.setValue(this.input.value,h(this))}space(t){super.space(t),l(this)}focus(){super.focus(),this.input.focus()}unfocus(){super.unfocus(),this.updateSpan()}generateHtml(){super.generateHtml(),this.html.classList.add(a.MENUCOMBOBOX)}generateSpan(){this.span=document.createElement("span"),this.span.classList.add(a.MENUINPUTBOX),this.input=document.createElement("input"),this.input.addEventListener("keydown",this.inputKey.bind(this)),this.input.setAttribute("size","10em"),this.input.setAttribute("type","text"),this.input.setAttribute("tabindex","-1"),this.span.appendChild(this.input)}inputKey(t){this.bubbleKey(),this.inputEvent=!0}keydown(t){if(this.inputEvent&&t.keyCode!==s.ESCAPE&&t.keyCode!==s.RETURN)return this.inputEvent=!1,void t.stopPropagation();super.keydown(t),t.stopPropagation()}updateAria(){}updateSpan(){let e;try{e=this.variable.getValue(h(this))}catch(t){e=""}this.input.value=e}toJson(){return{type:""}}}class rt extends d{static fromJson(t,{content:e,id:s},i){return new this(i,e,s)}constructor(t,e,s){super(t,"label",e,s)}generateHtml(){super.generateHtml(),this.html.classList.add(a.MENULABEL)}toJson(){return{type:""}}}class lt extends b{static fromJson(t,{content:e,variable:s,id:i},n){return new this(n,e,s,i)}constructor(t,e,s,i){super(t,"slider",e,i),this.role="slider",this.labelId="ctx_slideLabel"+c++,this.valueId="ctx_slideValue"+c++,this.inputEvent=!1,this.variable=t.pool.lookup(s),this.register()}executeAction(){this.variable.setValue(this.input.value,h(this)),this.update()}space(t){super.space(t),l(this)}focus(){super.focus(),this.input.focus()}unfocus(){super.unfocus(),this.updateSpan()}generateHtml(){super.generateHtml(),this.html.classList.add(a.MENUSLIDER),this.valueSpan=document.createElement("span"),this.valueSpan.setAttribute("id",this.valueId),this.valueSpan.classList.add(a.SLIDERVALUE),this.html.appendChild(this.valueSpan)}generateSpan(){this.span=document.createElement("span"),this.labelSpan=document.createElement("span"),this.labelSpan.setAttribute("id",this.labelId),this.labelSpan.appendChild(this.html.childNodes[0]),this.html.appendChild(this.labelSpan),this.input=document.createElement("input"),this.input.setAttribute("type","range"),this.input.setAttribute("min","0"),this.input.setAttribute("max","100"),this.input.setAttribute("aria-valuemin","0"),this.input.setAttribute("aria-valuemax","100"),this.input.setAttribute("aria-labelledby",this.labelId),this.input.addEventListener("keydown",this.inputKey.bind(this)),this.input.addEventListener("input",this.executeAction.bind(this)),this.input.classList.add(a.SLIDERBAR),this.span.appendChild(this.input)}inputKey(t){this.inputEvent=!0}mousedown(t){t.stopPropagation()}mouseup(t){event.stopPropagation()}keydown(t){var e=t.keyCode;return e===s.UP||e===s.DOWN?(t.preventDefault(),void super.keydown(t)):(this.inputEvent&&e!==s.ESCAPE&&e!==s.RETURN?this.inputEvent=!1:super.keydown(t),void t.stopPropagation())}updateAria(){var t=this.variable.getValue();t&&this.input&&(this.input.setAttribute("aria-valuenow",t),this.input.setAttribute("aria-valuetext",t+"%"))}updateSpan(){let e;try{e=this.variable.getValue(h(this)),this.valueSpan.innerHTML=e+"%"}catch(t){e=""}this.input.value=e}toJson(){return{type:""}}}class ht extends q{static fromJson(e,{title:t,values:s,variable:i},n){const o=new this(n),a=e.get("label")(e,{content:t||"",id:t||"id"},o),r=e.get("rule")(e,{},o),l=s.map(t=>e.get("radio")(e,{content:t,variable:i,id:t},o)),h=[a,r].concat(l);return o.items=h,o}constructor(t){super(),this.anchor=t,this.className=a.SELECTIONMENU,this.variablePool=this.anchor.menu.pool,this.baseMenu=this.anchor.menu}generateHtml(){super.generateHtml(),this.items.forEach(t=>t.html.classList.add(a.SELECTIONITEM))}display(){}right(t){this.anchor.right(t)}left(t){this.anchor.left(t)}}class g extends p{static fromJson(e,{title:t,signature:s,selections:i,order:n,grid:o},a){const r=new this(t,s,n,o);r.attachMenu(a);t=i.map(t=>e.get("selectionMenu")(e,t,r));return r.selections=t,r}constructor(t,e,s="none",i="vertical"){super(t,null,e),this.style=s,this.grid=i,this._selections=[],this.prefix="ctxt-selection",this._balanced=!0}attachMenu(t){this.menu=t}get selections(){return this._selections}set selections(t){this._selections=[],t.forEach(t=>this.addSelection(t))}addSelection(t){(t.anchor=this)._selections.push(t)}rowDiv(t){const e=document.createElement("div"),s=(this.contentDiv.appendChild(e),t.map(t=>(e.appendChild(t.html),t.html.id||(t.html.id=this.prefix+c++),t.html.getBoundingClientRect()))),i=s.map(t=>t.width),n=i.reduce((t,e)=>t+e,0),o=s.reduce((t,e)=>Math.max(t,e.height),0);return e.classList.add(a.SELECTIONDIVIDER),e.setAttribute("style","height: "+o+"px;"),[e,n,o,i]}display(){if(super.display(),this.order(),this.selections.length){const n=[];let e=0,s=[];var i=this.getChunkSize(this.selections.length);for(let t=0;t<this.selections.length;t+=i){const o=this.selections.slice(t,t+i),[a,r,l,h]=this.rowDiv(o);n.push(a),e=Math.max(e,r),o.forEach(t=>t.html.style.height=l+"px"),s=this.combineColumn(s,h)}this._balanced&&(this.balanceColumn(n,s),e=s.reduce((t,e)=>t+e,20)),n.forEach(t=>t.style.width=e+"px")}}getChunkSize(t){switch(this.grid){case"square":return Math.floor(Math.sqrt(t));case"horizontal":return Math.floor(t/g.chunkSize);default:return g.chunkSize}}balanceColumn(t,i){t.forEach(t=>{var s=Array.from(t.children);for(let t,e=0;t=s[e];e++)t.style.width=i[e]+"px"})}combineColumn(t,e){let s=[],i=0;for(;t[i]||e[i];){if(!t[i]){s=s.concat(e.slice(i));break}if(!e[i]){s=s.concat(t.slice(i));break}s.push(Math.max(t[i],e[i])),i++}return s}left(t){this.move(t,t=>(0===t?this.selections.length:t)-1)}right(t){this.move(t,t=>t===this.selections.length-1?0:t+1)}generateHtml(){super.generateHtml(),this.html.classList.add(a.SELECTION)}generateContent(){const t=super.generateContent();return t.classList.add(a.SELECTIONBOX),t.removeAttribute("tabindex"),t}findSelection(e){const s=e.target;let t=null;if(!(t=s.id?this.selections.find(t=>t.html.id===s.id):t)){const e=s.parentElement.id;t=this.selections.find(t=>t.html.id===e)}return t}move(t,e){const s=this.findSelection(t);s.focused&&s.focused.unfocus();t=e(this.selections.indexOf(s));this.selections[t].focus()}order(){this.selections.sort(g.orderMethod.get(this.style))}toJson(){return{type:""}}}g.chunkSize=4,g.orderMethod=new Map([["alphabetical",(t,e)=>t.items[0].content.localeCompare(e.items[0].content)],["none",(t,e)=>1],["decreasing",(t,e)=>{t=t.items.length,e=e.items.length;return t<e?1:e<t?-1:0}],["increasing",(t,e)=>{t=t.items.length,e=e.items.length;return t<e?-1:e<t?1:0}]]);class ut{constructor(t){this._parser=new Map(t)}get(t){return this._parser.get(t)}add(t,e){this._parser.set(t,e)}}class ct{constructor(t=[]){this._initList=[["command",it.fromJson.bind(it)],["checkbox",ot.fromJson.bind(ot)],["combo",at.fromJson.bind(at)],["slider",lt.fromJson.bind(lt)],["label",rt.fromJson.bind(rt)],["radio",et.fromJson.bind(et)],["rule",st.fromJson.bind(st)],["submenu",m.fromJson.bind(m)],["contextMenu",Y.fromJson.bind(Y)],["subMenu",Q.fromJson.bind(Q)],["variable",nt.fromJson.bind(nt)],["items",this.items.bind(this)],["selectionMenu",ht.fromJson.bind(ht)],["selectionBox",g.fromJson.bind(g)]],this._factory=new ut(this._initList),t.forEach(([t,e])=>this.factory.add(t,e))}get factory(){return this._factory}items(t,e,s){const i=[];for(const t of e){const e=this.parse(t,s);e&&(s.items.push(e),t.disabled&&e.disable(),t.hidden&&i.push(e))}return i.forEach(t=>t.hide()),s.items}parse(t,...e){var s=t["type"],t=function(t,e){var s={};for(n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(s[n]=t[n]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols)for(var i=0,n=Object.getOwnPropertySymbols(t);i<n.length;i++)e.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(t,n[i])&&(s[n[i]]=t[n[i]]);return s}(t,["type"]);const i=this.factory.get(s);return i?i(this.factory,t,...e):null}}function f(t){return"."+(a[t]||t)}const x={},v=(x[f("INFOCLOSE")]="{  top:.2em; right:.2em;}",x[f("INFOCONTENT")]="{  overflow:auto; text-align:left; font-size:80%;  padding:.4em .6em; border:1px inset; margin:1em 0px;  max-height:20em; max-width:30em; background-color:#EEEEEE;  white-space:normal;}",x[f("INFO")+f("MOUSEPOST")]="{outline:none;}",x[f("INFO")]='{  position:fixed; left:50%; width:auto; text-align:center;  border:3px outset; padding:1em 2em; background-color:#DDDDDD;  color:black;  cursor:default; font-family:message-box; font-size:120%;  font-style:normal; text-indent:0; text-transform:none;  line-height:normal; letter-spacing:normal; word-spacing:normal;  word-wrap:normal; white-space:nowrap; float:none; z-index:201;  border-radius: 15px;                     /* Opera 10.5 and IE9 */  -webkit-border-radius:15px;               /* Safari and Chrome */  -moz-border-radius:15px;                  /* Firefox */  -khtml-border-radius:15px;                /* Konqueror */  box-shadow:0px 10px 20px #808080;         /* Opera 10.5 and IE9 */  -webkit-box-shadow:0px 10px 20px #808080; /* Safari 3 & Chrome */  -moz-box-shadow:0px 10px 20px #808080;    /* Forefox 3.5 */  -khtml-box-shadow:0px 10px 20px #808080;  /* Konqueror */  filter:progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color="gray", Positive="true"); /* IE */}',{}),E=(v[f("MENU")]="{  position:absolute;  background-color:white;  color:black;  width:auto; padding:5px 0px;  border:1px solid #CCCCCC; margin:0; cursor:default;  font: menu; text-align:left; text-indent:0; text-transform:none;  line-height:normal; letter-spacing:normal; word-spacing:normal;  word-wrap:normal; white-space:nowrap; float:none; z-index:201;  border-radius: 5px;                     /* Opera 10.5 and IE9 */  -webkit-border-radius: 5px;             /* Safari and Chrome */  -moz-border-radius: 5px;                /* Firefox */  -khtml-border-radius: 5px;              /* Konqueror */  box-shadow:0px 10px 20px #808080;         /* Opera 10.5 and IE9 */  -webkit-box-shadow:0px 10px 20px #808080; /* Safari 3 & Chrome */  -moz-box-shadow:0px 10px 20px #808080;    /* Forefox 3.5 */  -khtml-box-shadow:0px 10px 20px #808080;  /* Konqueror */}",v[f("MENUITEM")]="{  padding: 1px 2em;  background:transparent;}",v[f("MENUARROW")]="{  position:absolute; right:.5em; padding-top:.25em; color:#666666;  font-family: null; font-size: .75em}",v[f("MENUACTIVE")+" "+f("MENUARROW")]="{color:white}",v[f("MENUARROW")+f("RTL")]="{left:.5em; right:auto}",v[f("MENUCHECK")]="{  position:absolute; left:.7em;  font-family: null}",v[f("MENUCHECK")+f("RTL")]="{ right:.7em; left:auto }",v[f("MENURADIOCHECK")]="{  position:absolute; left: .7em;}",v[f("MENURADIOCHECK")+f("RTL")]="{  right: .7em; left:auto}",v[f("MENUINPUTBOX")]="{  padding-left: 1em; right:.5em; color:#666666;  font-family: null;}",v[f("MENUINPUTBOX")+f("RTL")]="{  left: .1em;}",v[f("MENUCOMBOBOX")]="{  left:.1em; padding-bottom:.5em;}",v[f("MENUSLIDER")]="{  left: .1em;}",v[f("SLIDERVALUE")]="{  position:absolute; right:.1em; padding-top:.25em; color:#333333;  font-size: .75em}",v[f("SLIDERBAR")]="{  outline: none; background: #d3d3d3}",v[f("MENULABEL")]="{  padding: 1px 2em 3px 1.33em;  font-style:italic}",v[f("MENURULE")]="{  border-top: 1px solid #DDDDDD;  margin: 4px 3px;}",v[f("MENUDISABLED")]="{  color:GrayText}",v[f("MENUACTIVE")]="{  background-color: #606872;  color: white;}",v[f("MENUDISABLED")+":focus"]="{  background-color: #E8E8E8}",v[f("MENULABEL")+":focus"]="{  background-color: #E8E8E8}",v[f("CONTEXTMENU")+":focus"]="{  outline:none}",v[f("CONTEXTMENU")+" "+f("MENUITEM")+":focus"]="{  outline:none}",v[f("SELECTIONMENU")]="{  position:relative; float:left;  border-bottom: none; -webkit-box-shadow:none; -webkit-border-radius:0px; }",v[f("SELECTIONITEM")]="{  padding-right: 1em;}",v[f("SELECTION")]="{  right: 40%; width:50%; }",v[f("SELECTIONBOX")]="{  padding: 0em; max-height:20em; max-width: none;  background-color:#FFFFFF;}",v[f("SELECTIONDIVIDER")]="{  clear: both; border-top: 2px solid #000000;}",v[f("MENU")+" "+f("MENUCLOSE")]="{  top:-10px; left:-10px}",{});E[f("MENUCLOSE")]='{  position:absolute;  cursor:pointer;  display:inline-block;  border:2px solid #AAA;  border-radius:18px;  -webkit-border-radius: 18px;             /* Safari and Chrome */  -moz-border-radius: 18px;                /* Firefox */  -khtml-border-radius: 18px;              /* Konqueror */  font-family: "Courier New", Courier;  font-size:24px;  color:#F0F0F0}',E[f("MENUCLOSE")+" span"]="{  display:block; background-color:#AAA; border:1.5px solid;  border-radius:18px;  -webkit-border-radius: 18px;             /* Safari and Chrome */  -moz-border-radius: 18px;                /* Firefox */  -khtml-border-radius: 18px;              /* Konqueror */  line-height:0;  padding:8px 0 6px     /* may need to be browser-specific */}",E[f("MENUCLOSE")+":hover"]="{  color:white!important;  border:2px solid #CCC!important}",E[f("MENUCLOSE")+":hover span"]="{  background-color:#CCC!important}";let dt=!(E[f("MENUCLOSE")+":hover:focus"]="{  outline:none}"),mt=!1,pt=!1;function bt(t){pt||(gt(E,t),pt=!0)}function gt(t,e){const s=e||document,i=s.createElement("style");i.type="text/css";let n="";for(const e in t)n+=e,n+=" ",n+=t[e],n+="\n";i.innerHTML=n,s.head.appendChild(i)}class y extends Y{constructor(){super(...arguments),this.mathItem=null,this.nofocus=!1,this.errorMsg=""}post(t,e){var s;if(this.mathItem){const i=null==(s=null==(s=this.mathItem)?void 0:s.explorers)?void 0:s.speech;null!=i&&i.active&&(i.restarted=i.semanticFocus()),void 0!==e&&(this.getOriginalMenu(),this.getSemanticsMenu(),this.getSpeechMenu(),this.getBrailleMenu(),this.getSvgMenu(),this.getErrorMessage(),this.dynamicSubmenus()),super.post(t,e)}}unpost(){super.unpost(),this.mathItem&&(this.mathItem.outputData.nofocus=this.nofocus),this.mathItem=null,this.nofocus=!1}findID(...t){let e=this,s=null;for(const i of t){if(!e)return null;for(s of e.items){if(s.id===i){e=s instanceof m?s.submenu:null;break}e=s=null}}return s}setJax(t){this.jax=t}getOriginalMenu(){const t=this.mathItem.inputJax.name,e=this.findID("Show","Original");e.content="MathML"===t?"Original MathML":t+" Commands",this.findID("Copy","Original").content=e.content}getSemanticsMenu(){const t=this.findID("Settings","MathmlIncludes","semantics");"MathML"===this.mathItem.inputJax.name?t.disable():t.enable()}getSpeechMenu(){var t=this.mathItem.outputData.speech;this.findID("Show","Speech")[t?"enable":"disable"](),this.findID("Copy","Speech")[t?"enable":"disable"]()}getBrailleMenu(){var t=this.mathItem.outputData.braille;this.findID("Show","Braille")[t?"enable":"disable"](),this.findID("Copy","Braille")[t?"enable":"disable"]()}getSvgMenu(){var t=this.jax.SVG;this.findID("Show","SVG")[t?"enable":"disable"](),this.findID("Copy","SVG")[t?"enable":"disable"]()}getErrorMessage(){const t=this.mathItem.root.childNodes[0].childNodes;let e=!0;if(this.errorMsg="",1===t.length&&t[0].isKind("merror")){const s=t[0].attributes;this.errorMsg=s.get("data-mjx-error")||s.get("data-mjx-message")||"",e=!this.errorMsg}this.findID("Show","Error")[e?"disable":"enable"](),this.findID("Copy","Error")[e?"disable":"enable"]()}dynamicSubmenus(){for(const[t,[e,s]]of y.DynamicSubmenus){const i=this.find(t);i&&e(this,i,t=>{null==(t=null==(i.submenu=t)?void 0:t.items)||!t.length||s&&!this.settings[s]?i.disable():i.enable()})}}}y.DynamicSubmenus=new Map;const M=MathJax._.a11y.sre_ts,ft=M.locales,xt=(M.setupEngine,M.engineSetup,M.toEnriched,M.parseDOM,M.addPreference),vt=M.fromPreference,Et=M.toPreference;var yt=function(t,a,r,l){return new(r=r||Promise)(function(s,e){function i(t){try{o(l.next(t))}catch(t){e(t)}}function n(t){try{o(l.throw(t))}catch(t){e(t)}}function o(t){var e;t.done?s(t.value):((e=t.value)instanceof r?e:new r(function(t){t(e)})).then(i,n)}o((l=l.apply(t,a||[])).next())})};let C={},Mt=null;function Ct(t){var t=null==t?void 0:t.match(/^clearspeak-(.*)/);return Mt=null!=(t=null!=(t=t&&t[1])?t:Mt)?t:"default"}const S=new Map,St=new Map;let Ot=0;function wt(r,l,h){return yt(this,void 0,void 0,function*(){const e=t=>{h(r.factory.get("subMenu")(r.factory,{items:t,id:"Clearspeak"},l))};if(r.settings.speech&&r.settings.enrich){var s=r.pool.lookup("locale").getValue();if(yield function(t,e){return yt(this,void 0,void 0,function*(){S.has(e)||(yield t.mathItem.generatorPool.getLocalePreferences(S))})}(r,s),S.get(s)){const n=function(e,t){const s=S.get(t);{var i=e;t=Object.keys(s);const a=i.pool.lookup("speechRules"),r=Ct(i.settings.speechRules);C=vt(r);for(const r of t)i.factory.get("variable")(i.factory,{name:"csprf_"+r,setter:t=>{C[r]=t,a.setValue("clearspeak-"+Et(C))},getter:()=>C[r]||"Auto"},i.pool)}const n=[];for(const e of Object.getOwnPropertyNames(s))n.push({title:e,values:s[e].map(t=>t.replace(RegExp("^"+e+"_"),"")),variable:"csprf_"+e});const o=e.factory.get("selectionBox")(e.factory,{title:"Clearspeak Preferences",signature:"",order:"alphabetic",grid:"square",selections:n},e);return{type:"command",id:"ClearspeakPreferences",content:"Select Preferences",action:()=>o.post(0,0)}}(r,s);let t=[];if(r.settings.speech){const l=r.mathItem,h=null==(i=null==l?void 0:l.explorers)?void 0:i.speech,e=Ct(r.settings.speechRules),n=(t=t.concat([{type:"radio",content:"No Preferences",id:"clearspeak-default",variable:"speechRules"},{type:"radio",content:"Current Preferences",id:"clearspeak-"+e,variable:"speechRules"},{type:"rule"}]),null==h?void 0:h.refocus),o=null!=(i=null==n?void 0:n.getAttribute("data-semantic-id"))?i:null,a=Ot++;yield l.generatorPool.getRelevantPreferences(l,o,St,a);var i=St.get(a);if(St.delete(a),i){const r=function(e,t,s){const i=S.get(s);return[{type:"label",content:"Preferences for "+t},{type:"rule"}].concat(i[t].map(function(t){const[i,n]=t.split("_");return{type:"radioCompare",content:n,id:"clearspeak-"+xt(e,i,n),variable:"speechRules",comparator:(t,e)=>{if(t===e)return!0;if("Auto"!==n)return!1;var[t,s]=t.split("-"),[e]=e.split("-");return t===e&&!vt(s)[i]}}}))}(e,i,s);t=t.concat(r)}}t.splice(2,0,n),e(t)}else e([])}else e([])})}y.DynamicSubmenus.set("Clearspeak",[wt,"speech"]);let It=null;function Tt(t,e,s){if(It)s(It);else{const i=[];for(const t of ft.keys())"nemeth"!==t&&"euro"!==t&&i.push({type:"radio",id:t,content:ft.get(t)||t,variable:"locale"});i.sort((t,e)=>t.content.localeCompare(e.content,"en")),s(It=t.factory.get("subMenu")(t.factory,{items:i,id:"Language"},e))}}y.DynamicSubmenus.set("A11yLanguage",[Tt,"speech"]);const kt=MathJax._.util.context,At=kt.hasWindow,Lt=kt.context,O="MacOS"===Lt.os;function w(t){const e=Lt.document,s=e.createElement("textarea");s.value=t,s.setAttribute("readonly",""),s.style.cssText="height: 1px; width: 1px; padding: 1px; position: absolute; left: -10px",e.body.appendChild(s),s.select();try{e.execCommand("copy")}catch(t){alert("Can't copy to clipboard: "+t.message)}e.body.removeChild(s)}function Nt(a,r,l){return(s,t)=>{var e=function(){var t;let e=null==(t=s.mathItem)?void 0:t.root;for(;e&&!e.isKind("semantics");){if(e.isToken||1!==e.childNodes.length)return null;e=e.childNodes[0]}return e}(),i=r,n=l;if(e)for(const o of e.childNodes)if(o.isKind("annotation")){const e=function(t,e){var s=t.attributes.get("encoding");for(const t of Object.keys(e))if(e[t].includes(s))return t;return null}(o,i);if(e){const i=o.childNodes.reduce((t,e)=>t+e.toString(),"");n.push([e,i])}}return a.attachMenu(s),Rt(s,t,l,()=>a.post())}}function Dt(i){return(t,e)=>{var s=i.slice();return i.length=0,Rt(t,e,s,()=>w(I.trim()))}}let I="";function Rt(t,e,s,i){return t.factory.get("subMenu")(t.factory,{items:s.map(([t,e])=>({type:"command",id:t,content:t,action:()=>{I=e,i()}})),id:"annotations"},e)}const T=MathJax._.mathjax.mathjax,k=MathJax._.core.MathItem,A=(k.protoItem,k.AbstractMathItem,k.STATE),Pt=k.newState,L=MathJax._.util.Options,N=(L.isObject,L.APPEND,L.REMOVE,L.OPTIONS,L.Expandable,L.expandable),_t=(L.makeArray,L.keys,L.copy,L.insert,L.defaultOptions),Ut=L.userOptions;L.selectOptions,L.selectOptionsFromKeys,L.separateOptions,L.lookup;class Jt extends et{static fromJson(t,{content:e,variable:s,id:i,comparator:n},o){return new this(o,e,s,i,n)}constructor(t,e,s,i,n){super(t,e,s,i),this.comparator=n,this.role="menuitemradiocompare"}updateAria(){this.html.setAttribute("aria-checked",this.comparator(this.variable.getValue(),this.id)?"true":"false")}updateSpan(){this.span.style.display=this.comparator(this.variable.getValue(),this.id)?"":"none"}}class Bt extends MathJax._.core.MmlTree.SerializedMmlVisitor.SerializedMmlVisitor{constructor(){super(...arguments),this.options={filterSRE:!0,filterTex:!0,texHints:!0,semantics:!1},this.mathItem=null}visitTree(t,e=null,s={}){return this.mathItem=e,Ut(this.options,s),this.visitNode(t,"")}visitTeXAtomNode(t,e){return this.options.texHints?super.visitDefault(t,e):t.childNodes[0]&&1===t.childNodes[0].childNodes.length?this.visitNode(t.childNodes[0],e):`${e}<mrow${this.getAttributes(t)}>\n`+this.childNodeMml(t,e+"  ","\n")+e+"</mrow>"}visitMathNode(t,e){if(!this.options.semantics||"TeX"!==this.mathItem.inputJax.name)return super.visitDefault(t,e);var s=t.childNodes.length&&1<t.childNodes[0].childNodes.length;return""+e+`<math${this.getAttributes(t)}>
${e}  <semantics>
`+(s?e+"    <mrow>\n":"")+this.childNodeMml(t,e+(s?"      ":"    "),"\n")+(s?e+"    </mrow>\n":"")+e+'    <annotation encoding="application/x-tex">'+this.mathItem.math+`</annotation>
${e}  </semantics>
${e}</math>`}getAttributeList(t){const e=super.getAttributeList(t);if(this.options.filterTex&&(delete e["data-latex"],delete e["data-latex-item"]),this.options.filterSRE){const t=Object.keys(e).filter(t=>t.match(/^(?:data-semantic-.*?|data-speech-node|role|aria-(?:level|posinset|setsize|owns))$/));for(const s of t)delete e[s]}return e}}class D extends p{keydown(t){if("a"===t.key&&(t.ctrlKey||t.metaKey))return this.selectAll(),void this.stop(t);super.keydown(t)}selectAll(){document.getSelection().selectAllChildren(this.html.querySelector(".CtxtMenu_InfoContent").firstChild)}copyToClipboard(){this.selectAll();try{document.execCommand("copy")}catch(t){alert("Can't copy to clipboard: "+t.message)}document.getSelection().removeAllRanges()}generateHtml(){super.generateHtml();const t=this.html.querySelector("span."+a.INFOSIGNATURE).appendChild(document.createElement("input"));t.type="button",t.value="Copy to Clipboard",t.addEventListener("click",t=>this.copyToClipboard())}}function Ht(t,a,r,l){return new(r=r||Promise)(function(s,e){function i(t){try{o(l.next(t))}catch(t){e(t)}}function n(t){try{o(l.throw(t))}catch(t){e(t)}}function o(t){var e;t.done?s(t.value):((e=t.value)instanceof r?e:new r(function(t){t(e)})).then(i,n)}o((l=l.apply(t,a||[])).next())})}const R=z;class P{get isLoading(){return 0<P.loading}get loadingPromise(){return this.isLoading?(P._loadingPromise||(P._loadingPromise=new Promise((t,e)=>{P._loadingOK=t,P._loadingFailed=e})),P._loadingPromise):Promise.resolve()}postInfo(t){this.menu.mathItem&&(this.menu.nofocus=!!this.menu.mathItem.outputData.nofocus),t.post()}constructor(t,e={}){this.settings=null,this.defaultSettings=null,this.menu=null,this.current=null,this.MmlVisitor=new Bt,this.jax={CHTML:null,SVG:null},this.rerenderStart=A.LAST,this.requiredExtensions=[],this.about=new p('<b style="font-size:120%;">MathJax</b> v'+T.version,()=>{const t=[];return t.push("Input Jax: "+this.document.inputJax.map(t=>t.name).join(", ")),t.push("Output Jax: "+this.document.outputJax.name),t.push("Document Type: "+this.document.kind),t.join("<br/>")},'<a href="https://www.mathjax.org">www.mathjax.org</a>'),this.help=new p("<b>MathJax Help</b>",()=>["<p><b>MathJax</b> is a JavaScript library that allows page"," authors to include mathematics within their web pages."," As a reader, you don't need to do anything to make that happen.</p>","<p><b>Browsers</b>: MathJax works with all modern browsers including"," Edge, Firefox, Chrome, Safari, Opera, and most mobile browsers.</p>","<p><b>Math Menu</b>: MathJax adds a contextual menu to equations."," Right-click or CTRL-click on any mathematics to access the menu.</p>",'<div style="margin-left: 1em;">',"<p><b>Show Math As:</b> These options allow you to view the formula's"," source markup (as MathML or in its original format).</p>","<p><b>Copy to Clipboard:</b> These options copy the formula's source markup,"," as MathML or in its original format, to the clipboard"," (in browsers that support that).</p>","<p><b>Math Settings:</b> These give you control over features of MathJax,"," such the size of the mathematics, the mechanism used to display equations,"," how to handle equations that are too wide, and the language to use for"," MathJax's menus and error messages (not yet implemented in v4).","</p>","<p><b>Accessibility</b>: MathJax can work with screen"," readers to make mathematics accessible to the visually impaired."," Turn on speech or braille generation to enable creation of speech strings"," and the ability to investigate expressions interactively.  You can control"," the style of the explorer in its menu.</p>","</div>","<p><b>Math Zoom</b>: If you are having difficulty reading an"," equation, MathJax can enlarge it to help you see it better, or"," you can scale all the math on the page to make it larger."," Turn these features on in the <b>Math Settings</b> menu.</p>","<p><b>Preferences</b>: MathJax uses your browser's localStorage database"," to save the preferences set via this menu locally in your browser.  These"," are not used to track you, and are not transferred or used remotely by"," MathJax in any way.</p>"].join("\n"),'<a href="https://www.mathjax.org">www.mathjax.org</a>'),this.mathmlCode=new D("MathJax MathML Expression",()=>{if(!this.menu.mathItem)return"";var t=this.toMML(this.menu.mathItem);return"<pre>"+this.formatSource(t)+"</pre>"},""),this.originalText=new D("MathJax Original Source",()=>{if(!this.menu.mathItem)return"";var t=this.menu.mathItem.math;return'<pre style="font-size:125%; margin:0">'+this.formatSource(t)+"</pre>"},""),this.annotationBox=new D("MathJax Annotation Text",()=>{var t=I;return'<pre style="font-size:125%; margin:0">'+this.formatSource(t)+"</pre>"},""),this.svgImage=new D("MathJax SVG Image",()=>'<div id="svg-image" style="font-family: monospace; font-size:125%; margin:0">Generative SVG Image...</div>',""),this.speechText=new D("MathJax Speech Text",()=>this.menu.mathItem?'<div style="font-size:125%; margin:0">'+this.formatSource(this.menu.mathItem.outputData.speech)+"</div>":"",""),this.brailleText=new D("MathJax Braille Code",()=>this.menu.mathItem?'<div style="font-size:125%; margin:0">'+this.formatSource(this.menu.mathItem.outputData.braille)+"</div>":"",""),this.errorMessage=new D("MathJax Error Message",()=>this.menu.mathItem?'<pre style="font-size:125%; margin:0">'+this.formatSource(this.menu.errorMsg)+"</pre>":"",""),this.zoomBox=new p("MathJax Zoomed Expression",()=>{if(!this.menu.mathItem)return"";const t=this.menu.mathItem.typesetRoot.cloneNode(!0);return t.style.margin="0",'<div style="font-size: '+1.25*parseFloat(this.settings.zscale)+'%">'+t.outerHTML+"</div>"},""),this.document=t,this.options=Ut(_t({},this.constructor.OPTIONS),e),this.initSettings(),this.mergeUserSettings(),this.initMenu(),this.applySettings()}initSettings(){var t;this.settings=this.options.settings,this.jax=this.options.jax;const e=this.document.outputJax;this.jax[e.name]=e,this.settings.renderer=e.name,this.settings.scale=e.options.scale,e.options.displayOverflow&&(this.settings.overflow=e.options.displayOverflow.substring(0,1).toUpperCase()+e.options.displayOverflow.substring(1).toLowerCase()),this.settings.breakInline=null==(t=e.options.linebreaks)?void 0:t.inline,this.defaultSettings=Object.assign({},this.document.options.a11y,this.settings),this.setA11y({roleDescription:this.settings.roleDescription})}initMenu(){const t=new ct([["contextMenu",y.fromJson.bind(y)],["radioCompare",Jt.fromJson.bind(Jt)]]),e=(this.menu=t.parse({type:"contextMenu",id:"MathJax_Menu",pool:[this.variable("showSRE"),this.variable("showTex"),this.variable("texHints"),this.variable("semantics"),this.variable("zoom"),this.variable("zscale"),this.variable("renderer",t=>this.setRenderer(t)),this.variable("overflow",t=>this.setOverflow(t)),this.variable("breakInline",t=>this.setInlineBreaks(t)),this.variable("alt"),this.variable("cmd"),this.variable("ctrl"),this.variable("shift"),this.variable("scale",t=>this.setScale(t)),this.a11yVar("speech",t=>this.setSpeech(t)),this.a11yVar("braille",t=>this.setBraille(t)),this.variable("brailleCode",t=>this.setBrailleCode(t)),this.a11yVar("highlight",t=>this.setHighlight(t)),this.a11yVar("backgroundColor"),this.a11yVar("backgroundOpacity"),this.a11yVar("foregroundColor"),this.a11yVar("foregroundOpacity"),this.a11yVar("subtitles"),this.a11yVar("viewBraille"),this.a11yVar("voicing"),this.a11yVar("roleDescription",()=>this.setRoleDescription()),this.a11yVar("help"),this.a11yVar("locale",t=>this.setLocale(t)),this.variable("speechRules",t=>{var[t,e]=t.split("-");this.document.options.sre.domain=t,this.document.options.sre.style=e,this.rerender(A.COMPILED)}),this.a11yVar("magnification"),this.a11yVar("magnify"),this.a11yVar("treeColoring"),this.a11yVar("infoType"),this.a11yVar("infoRole"),this.a11yVar("infoPrefix"),this.variable("autocollapse"),this.variable("collapsible",t=>this.setCollapsible(t)),this.variable("enrich",t=>this.setEnrichment(t)),this.variable("inTabOrder",t=>this.setTabOrder(t)),this.a11yVar("tabSelects"),this.variable("assistiveMml",t=>this.setAssistiveMml(t))],items:[this.submenu("Show","Show Math As",[this.command("MathMLcode","MathML Code",()=>this.postInfo(this.mathmlCode)),this.command("Original","Original Form",()=>this.postInfo(this.originalText)),this.rule(),this.command("Speech","Speech Text",()=>this.postInfo(this.speechText),{disabled:!0}),this.command("Braille","Braille Code",()=>this.postInfo(this.brailleText),{disabled:!0}),this.command("SVG","SVG Image",()=>this.postSvgImage(),{disabled:!0}),this.submenu("ShowAnnotation","Annotation"),this.rule(),this.command("Error","Error Message",()=>this.postInfo(this.errorMessage),{disabled:!0})]),this.submenu("Copy","Copy to Clipboard",[this.command("MathMLcode","MathML Code",()=>this.copyMathML()),this.command("Original","Original Form",()=>this.copyOriginal()),this.rule(),this.command("Speech","Speech Text",()=>this.copySpeechText(),{disabled:!0}),this.command("Braille","Braille Code",()=>this.copyBrailleText(),{disabled:!0}),this.command("SVG","SVG Image",()=>this.copySvgImage(),{disabled:!0}),this.submenu("CopyAnnotation","Annotation"),this.rule(),this.command("Error","Error Message",()=>this.copyErrorMessage(),{disabled:!0})]),this.rule(),this.submenu("Settings","Math Settings",[this.submenu("Renderer","Math Renderer",this.radioGroup("renderer",[["CHTML"],["SVG"]])),this.submenu("Overflow","Wide Expressions",[this.radioGroup("overflow",[["Overflow"],["Scroll"],["Linebreak"],["Scale"],["Truncate"],["Elide"]]),this.rule(),this.checkbox("BreakInline","Allow In-line Breaks","breakInline")]),this.rule(),this.submenu("MathmlIncludes","MathML/SVG has",[this.checkbox("showSRE","Semantic attributes","showSRE"),this.checkbox("showTex","LaTeX attributes","showTex"),this.checkbox("texHints","TeX hints","texHints"),this.checkbox("semantics","Original as annotation","semantics")]),this.submenu("Language","Language"),this.rule(),this.submenu("ZoomTrigger","Zoom Trigger",[this.command("ZoomNow","Zoom Once Now",()=>this.zoom(null,"",this.menu.mathItem)),this.rule(),this.radioGroup("zoom",[["Click"],["DoubleClick","Double-Click"],["NoZoom","No Zoom"]]),this.rule(),this.label("TriggerRequires","Trigger Requires:"),this.checkbox(O?"Option":"Alt",O?"Option":"Alt","alt"),this.checkbox("Command","Command","cmd",{hidden:!O}),this.checkbox("Control","Control","ctrl",{hiddne:O}),this.checkbox("Shift","Shift","shift")]),this.submenu("ZoomFactor","Zoom Factor",this.radioGroup("zscale",[["150%"],["175%"],["200%"],["250%"],["300%"],["400%"]])),this.rule(),this.command("Scale","Scale All Math...",()=>this.scaleAllMath()),this.rule(),this.command("Reset","Reset to defaults",()=>this.resetDefaults())]),this.rule(),this.label("Accessibility","   Accessibility:"),this.submenu("Speech","    Speech",[this.checkbox("Generate","Generate","speech"),this.checkbox("Subtitles","Show Subtitles","subtitles"),this.checkbox("Auto Voicing","Auto Voicing","voicing"),this.rule(),this.label("Rules","Rules:"),this.submenu("Mathspeak","Mathspeak",this.radioGroup("speechRules",[["mathspeak-default","Verbose"],["mathspeak-brief","Brief"],["mathspeak-sbrief","Superbrief"]])),this.submenu("Clearspeak","Clearspeak",this.radioGroup("speechRules",[["clearspeak-default","Auto"]])),this.rule(),this.submenu("A11yLanguage","Language")]),this.submenu("Braille","    Braille",[this.checkbox("Generate","Generate","braille"),this.checkbox("Subtitles","Show Subtitles","viewBraille"),this.rule(),this.label("Code","Code Format:"),this.radioGroup("brailleCode",[["nemeth","Nemeth"],["ueb","UEB"],["euro","Euro"]])]),this.submenu("Explorer","    Explorer",[this.submenu("Highlight","Highlight",[this.submenu("Background","Background",this.radioGroup("backgroundColor",[["Blue"],["Red"],["Green"],["Yellow"],["Cyan"],["Magenta"],["White"],["Black"]])),{type:"slider",variable:"backgroundOpacity",content:" "},this.submenu("Foreground","Foreground",this.radioGroup("foregroundColor",[["Black"],["White"],["Magenta"],["Cyan"],["Yellow"],["Green"],["Red"],["Blue"]])),{type:"slider",variable:"foregroundOpacity",content:" "},this.rule(),this.radioGroup("highlight",[["None"],["Hover"],["Flame"]]),this.rule(),this.checkbox("TreeColoring","Tree Coloring","treeColoring")]),this.submenu("Magnification","Magnification",[this.radioGroup("magnification",[["None"],["Keyboard"],["Mouse"]]),this.rule(),this.radioGroup("magnify",[["200%"],["300%"],["400%"],["500%"]])]),this.submenu("Semantic Info","Semantic Info",[this.checkbox("Type","Type","infoType"),this.checkbox("Role","Role","infoRole"),this.checkbox("Prefix","Prefix","infoPrefix")]),this.rule(),this.submenu("Role Description","Describe math as",[this.radioGroup("roleDescription",[["MathJax expression"],["MathJax"],["math"],["clickable math"],["explorable math"],["none"]])]),this.checkbox("Math Help","Help message on focus","help")]),this.submenu("Options","    Options",[this.checkbox("Enrich","Semantic Enrichment","enrich"),this.checkbox("Collapsible","Collapsible Math","collapsible"),this.checkbox("AutoCollapse","Auto Collapse","autocollapse",{disabled:!0}),this.rule(),this.checkbox("InTabOrder","Include in Tab Order","inTabOrder"),this.submenu("TabSelects","Tabbing Focuses on",[this.radioGroup("tabSelects",[["all","Whole Expression"],["last","Last Explored Node"]])]),this.rule(),this.checkbox("AssistiveMml","Include Hidden MathML","assistiveMml")]),this.rule(),this.command("About","About MathJax",()=>this.postInfo(this.about)),this.command("Help","MathJax Help",()=>this.postInfo(this.help))]}),this.menu);e.settings=this.settings,e.findID("Settings","Overflow","Elide").disable(),e.findID("Braille","ueb").hide(),e.setJax(this.jax),this.attachDialogMenus(e),this.checkLoadableItems();var s=[];y.DynamicSubmenus.set("ShowAnnotation",[Nt(this.annotationBox,this.options.annotationTypes,s),""]),y.DynamicSubmenus.set("CopyAnnotation",[Dt(s),""]),s=this.document.document,dt||(gt(x,s),dt=!0,bt(s)),s=this.document.document,mt||(gt(v,s),mt=!0,bt(s))}attachDialogMenus(t){this.about.attachMenu(t),this.help.attachMenu(t),this.originalText.attachMenu(t),this.mathmlCode.attachMenu(t),this.originalText.attachMenu(t),this.svgImage.attachMenu(t),this.speechText.attachMenu(t),this.brailleText.attachMenu(t),this.errorMessage.attachMenu(t),this.zoomBox.attachMenu(t)}checkLoadableItems(){var t,e;if(R&&R._&&R.loader&&R.startup){var s=this.settings,i=this.document.options;!(s.enrich||s.speech&&i.enableSpeech||s.braille&&i.enableBraille)||null!=(e=null==(t=R._)?void 0:t.a11y)&&e.explorer||this.loadA11y("explorer"),!s.collapsible||null!=(t=null==(i=R._)?void 0:i.a11y)&&t.complexity||this.loadA11y("complexity"),!s.assistiveMml||null!=(i=null==(e=R._)?void 0:e.a11y)&&i["assistive-mml"]||this.loadA11y("assistive-mml")}else{const t=this.menu;for(const e of Object.keys(this.jax))this.jax[e]||t.findID("Settings","Renderer",e).disable();t.findID("Speech").disable(),t.findID("Braille").disable(),t.findID("Explorer").disable(),t.findID("Options","AutoCollapse").disable(),t.findID("Options","Collapsible").disable(),t.findID("Options","Enrich").disable(),t.findID("Options","AssistiveMml").disable()}}enableAccessibilityItems(t,e){const s=this.menu.findID(t).submenu;for(const t of s.items.slice(1))t instanceof st||(!e||t instanceof m&&!t.submenu.items.length?t.disable():t.enable())}mergeUserSettings(){try{var t=localStorage.getItem(P.MENU_STORAGE);if(!t)return;Object.assign(this.settings,JSON.parse(t)),this.setA11y(this.settings)}catch(t){console.log("MathJax localStorage error: "+t.message)}}saveUserSettings(){const t={};for(const e of Object.keys(this.settings))this.settings[e]!==this.defaultSettings[e]&&(t[e]=this.settings[e]);try{Object.keys(t).length?localStorage.setItem(P.MENU_STORAGE,JSON.stringify(t)):localStorage.removeItem(P.MENU_STORAGE)}catch(t){console.log("MathJax localStorage error: "+t.message)}}setA11y(t){var e;null!=(e=null==(e=R._)?void 0:e.a11y)&&e.explorer&&R._.a11y.explorer_ts.setA11yOptions(this.document,t)}getA11y(t){var e;if(null!=(e=null==(e=R._)?void 0:e.a11y)&&e.explorer)return(void 0!==this.document.options.a11y[t]?this.document.options.a11y:this.document.options.sre)[t]}applySettings(){this.setTabOrder(this.settings.inTabOrder),this.document.options.enableAssistiveMml=this.settings.assistiveMml,this.enableAccessibilityItems("Speech",this.settings.speech),this.enableAccessibilityItems("Braille",this.settings.braille),this.setAccessibilityMenus();const s=this.settings.renderer.replace(/[^a-zA-Z0-9]/g,"")||"CHTML";(P._loadingPromise||Promise.resolve()).then(()=>{const t=this.settings,e=this.document.outputJax.options;if(e.scale=parseFloat(t.scale),e.displayOverflow=t.overflow.toLowerCase(),e.linebreaks&&(e.linebreaks.inline=t.breakInline),!t.speechRules){const s=this.document.options.sre;t.speechRules=`${s.domain||"clearspeak"}-`+(s.style||"default")}s!==this.defaultSettings.renderer&&this.document.whenReady(()=>this.setRenderer(s,!1))})}setOverflow(t){this.document.outputJax.options.displayOverflow=t.toLowerCase(),P.loading||this.document.rerenderPromise()}setInlineBreaks(t){this.document.outputJax.options.linebreaks.inline=t,P.loading||this.document.rerenderPromise()}setScale(t){this.document.outputJax.options.scale=parseFloat(t),P.loading||this.document.rerenderPromise()}setRenderer(i,n=!0){if(Object.hasOwn(this.jax,i)&&this.jax[i])return this.setOutputJax(i,n);const o=i.toLowerCase();return new Promise((e,s)=>{this.loadComponent("output/"+o,()=>{const t=R.startup;if(!(o in t.constructors))return s(new Error(`Component ${o} not loaded`));t.useOutput(o,!0),t.output=t.getOutputJax(),t.output.setAdaptor(this.document.adaptor),t.output.initialize(),this.jax[i]=t.output,this.setOutputJax(i,n).then(()=>e()).catch(t=>s(t))})})}setOutputJax(t,e=!0){this.jax[t].setAdaptor(this.document.adaptor),this.document.outputJax=this.jax[t];const s=this.loadRequiredExtensions();return e?s.then(()=>T.handleRetriesFor(()=>this.rerender())):s.then(()=>{})}loadRequiredExtensions(){const t=this.document.outputJax.name.toLowerCase(),e=[];for(const s of this.requiredExtensions)e.push(R.loader.load(`[${s}]/`+t));return this.requiredExtensions=[],Promise.all(e)}addRequiredExtensions(t){t&&(t=new Set([...this.requiredExtensions,...t]),this.requiredExtensions=[...t])}setTabOrder(t){const e=this.menu.findID("Options","TabSelects");t?e.enable():e.disable(),this.menu.store.inTaborder(t)}setAssistiveMml(t){!(this.document.options.enableAssistiveMml=t)||null!=(t=null==(t=R._)?void 0:t.a11y)&&t["assistive-mml"]?this.rerender():this.loadA11y("assistive-mml")}setAccessibilityMenus(){const t=this.settings.enrich,e=t?"enable":"disable",s=(["Speech","Braille","Explorer"].forEach(t=>this.menu.findID(t)[e]()),this.document.options);(s.enableSpeech=s.enableBraille=s.enableExplorer=t)||(this.settings.collapsible=!1,this.document.options.enableCollapsible=!1)}setSpeech(t){this.enableAccessibilityItems("Speech",t),!(this.document.options.enableSpeech=t)||null!=(t=null==(t=R._)?void 0:t.a11y)&&t.explorer?this.rerender(A.COMPILED):this.loadA11y("explorer")}setBraille(t){this.enableAccessibilityItems("Braille",t),!(this.document.options.enableBraille=t)||null!=(t=null==(t=R._)?void 0:t.a11y)&&t.explorer?this.rerender(A.COMPILED):this.loadA11y("explorer")}setBrailleCode(t){this.document.options.sre.braille=t,this.rerender(A.COMPILED)}setLocale(t){this.document.options.sre.locale=t,this.rerender(A.COMPILED)}setRoleDescription(){this.rerender(A.COMPILED)}setEnrichment(t){this.document.options.enableEnrichment=t,this.setAccessibilityMenus(),!t||null!=(t=null==(t=R._)?void 0:t.a11y)&&t.explorer?this.rerender(A.COMPILED):this.loadA11y("explorer")}setCollapsible(t){(this.document.options.enableComplexity=t)&&!this.settings.enrich&&(this.settings.enrich=this.document.options.enableEnrichment=!0,this.setAccessibilityMenus()),t||this.menu.pool.lookup("highlight").setValue("None"),!t||null!=(t=null==(t=R._)?void 0:t.a11y)&&t.complexity?this.rerender(A.COMPILED):(this.loadA11y("complexity"),null!=(t=null==(t=R._)?void 0:t.a11y)&&t.explorer||this.loadA11y("explorer"))}setHighlight(t){var e,s;if("None"!==t){if(!this.settings.collapsible){const t=this.menu.pool.lookup("collapsible");t.setValue(!0),null!=(s=null==(e=t.items[0])?void 0:e.executeCallbacks_)&&s.call(e)}P.loadingPromises.has("a11y/complexity")||this.rerender(A.COMPILED)}}scaleAllMath(){const t=(100*parseFloat(this.settings.scale)).toFixed(1).replace(/.0$/,""),e=prompt("Scale all mathematics (compared to surrounding text) by",t+"%");if(this.current){const t=this.menu.mathItem.explorers.speech;t.refocus=this.current,t.focus()}if(e)if(e.match(/^\s*\d+(\.\d*)?\s*%?\s*$/)){const t=parseFloat(e)/100;t?this.menu.pool.lookup("scale").setValue(String(t)):alert("The scale should not be zero")}else alert("The scale should be a percentage (e.g., 120%)")}resetDefaults(){P.loading++;const t=this.menu.pool,e=this.defaultSettings;for(const s of Object.keys(e)){const i=t.lookup(s);if(i){if(i.getValue()!==e[s]){i.setValue(e[s]);const t=i.items[0];t&&t.executeCallbacks_()}}else Object.hasOwn(this.settings,s)&&(this.settings[s]=e[s])}P.loading--,this.rerender(A.COMPILED)}checkComponent(t){t=P.loadingPromises.get(t);t&&T.retryAfter(t)}loadComponent(t,e){if(!P.loadingPromises.has(t)){const i=R.loader;var s;i&&(P.loading++,s=i.load(t).then(()=>{P.loading--,P.loadingPromises.delete(t),0===P.loading&&P._loadingPromise&&(P._loadingPromise=null,P._loadingOK()),e()}).catch(t=>{P._loadingPromise?(P._loadingPromise=null,P._loadingFailed(t)):console.log(t)}),P.loadingPromises.set(t,s))}}loadA11y(i){const n=!A.ENRICHED;this.loadComponent("a11y/"+i,()=>{var t;const e=R.startup;T.handlers.unregister(e.handler),e.handler=e.getHandler(),T.handlers.register(e.handler);var s=this.document;this.document=e.document=e.getDocument(),this.document.processed=s.processed,this.document.menu=this,s.webworker&&(this.document.webworker=s.webworker),this.setA11y(this.settings),this.defaultSettings=Object.assign({},this.document.options.a11y,(null==(t=null==(t=R.config)?void 0:t.options)?void 0:t.a11y)||{},this.defaultSettings),this.document.outputJax.reset(),this.transferMathList(s),this.document.processed=s.processed,P._loadingPromise||(this.document.outputJax.reset(),T.handleRetriesFor(()=>{this.rerender("complexity"===i||n?A.COMPILED:A.TYPESET)}))})}transferMathList(t){const e=this.document.options.MathItem;for(const s of t.math){const t=new e;Object.assign(t,s),this.document.math.push(t)}}formatSource(t){return t.trim().replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}toMML(t){return this.MmlVisitor.visitTree(t.root,t,{filterSRE:!this.settings.showSRE,filterTex:!this.settings.showTex,texHints:this.settings.texHints,semantics:this.settings.semantics&&"MathML"!==t.inputJax.name})}toSVG(t){const e=this.jax.SVG;if(!e)return Promise.resolve("SVG can't be produced.<br>Try switching to SVG output first.");const s=e.adaptor,i=e.options.fontCache,n=!!t.root.getProperty("process-breaks");if("global"!==i&&(t.display||!n)&&"SVG"===s.getAttribute(t.typesetRoot,"jax"))for(const e of s.childNodes(t.typesetRoot))if("svg"===s.kind(e))return Promise.resolve(this.formatSvg(s.serializeXML(e)));return this.typesetSVG(t,i,n)}typesetSVG(i,n,o){return Ht(this,void 0,void 0,function*(){const t=this.jax.SVG,e=t.html("div"),s=("global"===n&&(t.options.fontCache="local"),i.root);return i.root=s.copy(!0),i.root.setInheritedAttributes({},i.display,0,!1),o&&(t.unmarkInlineBreaks(i.root),i.root.setProperty("inlineMarked",!1)),T.handleRetriesFor(()=>{t.toDOM(i,e,t.document)}).then(()=>(i.root=s,t.options.fontCache=n,this.formatSvg(t.adaptor.innerHTML(e))))})}formatSvg(t){var e=this.constructor.SvgCss;return t=(t=t.match(/^<svg.*?><defs>/)?t.replace(/<defs>/,`<defs><style>${e}</style>`):t.replace(/^(<svg.*?>)/,`$1<defs><style>${e}</style></defs>`)).replace(/ (?:role|focusable)=".*?"/g,"").replace(/"currentColor"/g,'"black"'),this.settings.showSRE||(t=t.replace(/ (?:data-semantic-.*?|data-speech-node|role|aria-(?:level|posinset|setsize|owns))=".*?"/g,"")),this.settings.showTex||(t=t.replace(/ data-latex(?:-item)?=".*?"/g,"")),`<?xml version="1.0" encoding="UTF-8" standalone="no"?>
`+(t=this.settings.texHints?t:t.replace(/ data-mjx-(?:texclass|alternate|variant|pseudoscript|smallmatrix|mathaccent|auto-op|script-align|vbox)=".*?"/g,"").replace(/ data-mml-node="TeXAtom"/g,""))}postSvgImage(){this.postInfo(this.svgImage),this.toSVG(this.menu.mathItem).then(t=>{this.svgImage.html.querySelector("#svg-image").innerHTML=this.formatSource(t).replace(/\n/g,"<br>")})}zoom(t,e,s){t&&!this.isZoomEvent(t,e)||(this.menu.mathItem=s,t&&this.menu.post(t),this.postInfo(this.zoomBox))}isZoomEvent(t,e){return this.settings.zoom===e&&(!this.settings.alt||t.altKey)&&(!this.settings.ctrl||t.ctrlKey)&&(!this.settings.cmd||t.metaKey)&&(!this.settings.shift||t.shiftKey)}rerender(t=A.TYPESET){this.rerenderStart=Math.min(t,this.rerenderStart);const e=R.startup;!P.loading&&e.hasTypeset&&e.document.whenReady(()=>Ht(this,void 0,void 0,function*(){this.rerenderStart<=A.COMPILED&&this.document.reset({inputJax:[]}),yield this.document.rerenderPromise(this.rerenderStart),this.rerenderStart=A.LAST}))}copyMathML(){w(this.toMML(this.menu.mathItem))}copyOriginal(){w(this.menu.mathItem.math.trim())}copySvgImage(){this.toSVG(this.menu.mathItem).then(t=>{w(t)})}copySpeechText(){w(this.menu.mathItem.outputData.speech)}copyBrailleText(){w(this.menu.mathItem.outputData.braille)}copyErrorMessage(){w(this.menu.errorMsg.trim())}addMenu(t){this.addEvents(t),this.menu.store.insert(t.typesetRoot),t.typesetRoot.tabIndex=this.settings.inTabOrder?0:-1}addEvents(s){const t=s.typesetRoot;t.addEventListener("mousedown",()=>{var t;this.menu.mathItem=s,this.current=null==(t=null==(t=s.explorers)?void 0:t.speech)?void 0:t.current},!0),t.addEventListener("contextmenu",()=>{var t;const e=null==(t=(this.menu.mathItem=s).explorers)?void 0:t.speech;e&&(s.outputData.nofocus=!this.current,e.refocus=this.current)},!0),t.addEventListener("keydown",()=>this.menu.mathItem=s,!0),t.addEventListener("click",t=>this.zoom(t,"Click",s),!0),t.addEventListener("dblclick",t=>this.zoom(t,"DoubleClick",s),!0)}clear(){this.menu.store.clear()}variable(e,s){return{name:e,getter:()=>this.settings[e],setter:t=>{this.settings[e]=t,s&&s(t),this.saveUserSettings()}}}a11yVar(e,s){return{name:e,getter:()=>this.getA11y(e),setter:t=>{this.settings[e]=t,this.setA11y({[e]:t}),s&&s(t),this.saveUserSettings()}}}submenu(t,e,s=[],i=!1){let n=[];for(const t of s)Array.isArray(t)?n=n.concat(t):n.push(t);return{type:"submenu",id:t,content:e,menu:{items:n},disabled:0===n.length||i}}command(t,e,s,i={}){return Object.assign({type:"command",id:t,content:e,action:s},i)}checkbox(t,e,s,i={}){return Object.assign({type:"checkbox",id:t,content:e,variable:s},i)}radioGroup(e,t){return t.map(t=>this.radio(t[0],t[1]||t[0],e))}radio(t,e,s,i={}){return Object.assign({type:"radio",id:t,content:e,variable:s},i)}label(t,e){return{type:"label",id:t,content:e}}rule(){return{type:"rule"}}}function Vt(t){return class extends t{addMenu(t,e=!1){this.state()>=A.CONTEXT_MENU||(this.isEscaped||!t.options.enableMenu&&!e||t.menu.addMenu(this),this.state(A.CONTEXT_MENU))}getMenus(t){t.menu.menu.store.sort()}checkLoading(t){t.checkLoading()}}}function Ft(t){var e;return(e=class extends t{constructor(...t){super(...t),this.menu=new this.options.MenuClass(this,this.options.menuOptions);const e=this.constructor.ProcessBits,s=(e.has("context-menu")||e.allocate("context-menu"),this.options.MathItem=Vt(this.options.MathItem),this.menu.settings),i=this.options,n=i.enableEnrichment=s.enrich;i.enableSpeech=s.speech&&n,i.enableBraille=s.braille&&n,i.enableComplexity=s.collapsible&&n,i.enableExplorer=n}addMenu(){if(!this.processed.isSet("context-menu")){for(const t of this.math)t.addMenu(this);this.processed.set("context-menu")}return this}getMenus(){this.menu.menu.store.sort()}checkLoading(){let t=!0;try{this._checkLoading(),t=!1}catch(t){if(!t.retry)throw t}return t}_checkLoading(){return this.menu.isLoading&&T.retryAfter(this.menu.loadingPromise.catch(t=>console.log(t))),this.options.enableComplexity&&this.menu.checkComponent("a11y/complexity"),this.options.enableExplorer&&this.menu.checkComponent("a11y/explorer"),this}state(t,e=!1){return super.state(t,e),t<A.CONTEXT_MENU&&this.processed.clear("context-menu"),this}}).OPTIONS=Object.assign(Object.assign({enableEnrichment:!0,enableComplexity:!0,enableSpeech:!0,enableBraille:!0,enableExplorer:!0,enrichSpeech:"none",enrichError:(t,e,s)=>console.warn("Enrichment Error:",s)},t.OPTIONS),{MenuClass:P,menuOptions:P.OPTIONS,enableMenu:!0,sre:t.OPTIONS.sre||N({}),a11y:t.OPTIONS.a11y||N({}),renderActions:N(Object.assign(Object.assign({},t.OPTIONS.renderActions),{addMenu:[A.CONTEXT_MENU],getMenus:[A.INSERTED+5,!1],checkLoading:[A.UNPROCESSED+1,t=>t.checkLoading(),"",!1]}))}),e}function jt(t){return t.documentClass=Ft(t.documentClass),t}P.MENU_STORAGE="MathJax-Menu-Settings",P.OPTIONS={settings:{showSRE:!1,showTex:!1,texHints:!0,semantics:!1,zoom:"NoZoom",zscale:"200%",renderer:"CHTML",alt:!1,cmd:!1,ctrl:!1,shift:!1,scale:1,overflow:"Scroll",breakInline:!0,autocollapse:!1,collapsible:!1,enrich:!0,inTabOrder:!0,assistiveMml:!1,speech:!0,braille:!0,brailleCode:"nemeth",speechRules:"clearspeak-default",roleDescription:"math",tabSelects:"all"},jax:{CHTML:null,SVG:null},annotationTypes:N({TeX:["TeX","LaTeX","application/x-tex"],StarMath:["StarMath 5.0"],Maple:["Maple"],ContentMathML:["MathML-Content","application/mathml-content+xml"],OpenMath:["OpenMath"]})},P.SvgCss=["svg a{fill:blue;stroke:blue}",'[data-mml-node="merror"]>g{fill:red;stroke:red}','[data-mml-node="merror"]>rect[data-background]{fill:yellow;stroke:none}',"[data-frame],[data-line]{stroke-width:70px;fill:none}",".mjx-dashed{stroke-dasharray:140}",".mjx-dotted{stroke-linecap:round;stroke-dasharray:0,140}","use[data-c]{stroke-width:3px}"].join(""),P.loading=0,P.loadingPromises=new Map,P._loadingPromise=null,P._loadingOK=null,P._loadingFailed=null,Pt("CONTEXT_MENU",170),MathJax.loader&&MathJax.loader.checkVersion("ui/menu","4.0.0","ui"),G({_:{a11y:{speech:{SpeechMenu:_}},ui:{menu:{AnnotationMenu:J,MJContextMenu:e,Menu:F,MenuHandler:j,MenuUtil:U,MmlVisitor:H,RadioCompare:B,SelectableInfo:V}}}}),MathJax.startup&&At&&MathJax.startup.extendHandler(t=>jt(t),20)})();
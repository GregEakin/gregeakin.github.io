(()=>{"use strict";var a={d:(t,e)=>{for(var s in e)a.o(e,s)&&!a.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},t={},e=(a.r(t),a.d(t,{FindMathML:()=>u}),{}),s=(a.r(e),a.d(e,{MathMLCompile:()=>g}),{});a.r(s),a.d(s,{MathML:()=>N});const r=("undefined"!=typeof window?window:global).MathJax._.components.global,i=(r.GLOBAL,r.isObject,r.combineConfig,r.combineDefaults,r.combineWithMathJax),o=(r.MathJax,MathJax._.core.InputJax.AbstractInputJax),n=MathJax._.util.Options,l=(n.isObject,n.APPEND,n.REMOVE,n.OPTIONS,n.Expandable,n.expandable,n.makeArray,n.keys,n.copy,n.insert,n.defaultOptions),h=n.userOptions,d=(n.selectOptions,n.selectOptionsFromKeys,n.separateOptions),c=(n.lookup,MathJax._.util.FunctionList.FunctionList),p=MathJax._.core.FindMath.AbstractFindMath,m="http://www.w3.org/1998/Math/MathML";class u extends p{findMath(t){var e=new Set,s=(this.findMathNodes(t,e),this.findMathPrefixed(t,e),this.adaptor.root(this.adaptor.document));return"html"===this.adaptor.kind(s)&&0===e.size&&this.findMathNS(t,e),this.processMath(e)}findMathNodes(t,e){for(const s of this.adaptor.tags(t,"math"))e.add(s)}findMathPrefixed(t,e){const s=this.adaptor.root(this.adaptor.document);for(const a of this.adaptor.allAttributes(s))if("xmlns:"===a.name.substring(0,6)&&a.value===m){const s=a.name.substring(6);for(const r of this.adaptor.tags(t,s+":math"))e.add(r)}}findMathNS(t,e){for(const s of this.adaptor.tags(t,"math",m))e.add(s)}processMath(t){const e=this.adaptor,s=[];for(const a of t.values())if("mjx-assistive-mml"!==e.kind(e.parent(a))){const t="block"===e.getAttribute(a,"display")||"display"===e.getAttribute(a,"mode"),r={node:a,n:0,delim:""},i={node:a,n:0,delim:""};s.push({math:e.outerHTML(a),start:r,end:i,display:t})}return s}}u.OPTIONS={};const M=MathJax._.core.MmlTree.MmlNode,f=M.TEXCLASS,b=(M.TEXCLASSNAMES,M.MATHVARIANTS,M.indentAttributes,M.AbstractMmlNode),x=(M.AbstractMmlTokenNode,M.AbstractMmlLayoutNode,M.AbstractMmlBaseNode,M.AbstractMmlEmptyNode,M.TextNode,M.XMLNode,MathJax._.util.Entities),y=(x.options,x.entities,x.add,x.remove,x.translate);x.numeric;class g{constructor(t={}){var e=this.constructor;this.options=h(l({},e.OPTIONS),t)}setMmlFactory(t){this.factory=t}compile(t){const e=this.makeNode(t);return e.verifyTree(this.options.verify),e.setInheritedAttributes({},!1,0,!1),e.walkTree(this.markMrows),e}makeNode(t){const e=this.adaptor;let s=!1;var a=e.kind(t).replace(/^.*:/,"");let r=e.getAttribute(t,"data-mjx-texclass")||"",i=(r=r&&(this.filterAttribute("data-mjx-texclass",r)||""))&&"mrow"===a?"TeXAtom":a;for(const o of this.filterClassList(e.allClasses(t)))o.match(/^MJX-TeXAtom-/)&&"mrow"===a?(r=o.substring(12),i="TeXAtom"):"MJX-fixedlimits"===o&&(s=!0);return this.factory.getNodeClass(i)?this.createMml(i,t,r,s):this.unknownNode(i,t)}createMml(t,e,s,a){const r=this.factory.create(t);return"TeXAtom"!==t||"OP"!==s||a||(r.setProperty("movesupsub",!0),r.attributes.setInherited("movablelimits",!0)),s&&(r.texClass=f[s],r.setProperty("texClass",r.texClass)),this.addAttributes(r,e),this.checkClass(r,e),this.addChildren(r,e),r}unknownNode(t,e){return this.factory.getNodeClass("html")&&this.options.allowHtmlInTokenNodes?this.factory.create("html").setHTML(e,this.adaptor):(this.error('Unknown node type "'+t+'"'),null)}addAttributes(t,e){let s=!1;for(const r of this.adaptor.allAttributes(e)){const e=r.name,i=this.filterAttribute(e,r.value);if(null!==i&&"xmlns"!==e)if("data-mjx-"===e.substring(0,9))switch(e.substring(9)){case"alternate":t.setProperty("variantForm",!0);break;case"variant":t.attributes.set("mathvariant",i),t.setProperty("ignore-variant",!0),s=!0;break;case"smallmatrix":t.setProperty("smallmatrix",!0),t.setProperty("useHeight",!1);break;case"mathaccent":t.setProperty("mathaccent","true"===i);break;case"auto-op":t.setProperty("autoOP","true"===i);break;case"script-align":t.setProperty("scriptalign",i);break;case"vbox":t.setProperty("vbox",i);break;default:t.attributes.set(e,i)}else{var a;"class"!==e&&("true"===(a=i.toLowerCase())||"false"===a?t.attributes.set(e,"true"===a):s&&"mathvariant"===e||t.attributes.set(e,i))}}}filterAttribute(t,e){return e}filterClassList(t){return t}addChildren(t,e){if(0!==t.arity){const s=this.adaptor;for(const a of s.childNodes(e)){const e=s.kind(a);if("#comment"!==e)if("#text"===e)this.addText(t,a);else if(t.isKind("annotation-xml"))t.appendChild(this.factory.create("XML").setXML(a,s));else{const e=t.appendChild(this.makeNode(a));0===e.arity&&s.childNodes(a).length&&!e.isKind("html")&&(this.options.fixMisplacedChildren?this.addChildren(t,a):e.mError("There should not be children for "+e.kind+" nodes",this.options.verify,!0))}}t.isToken&&this.trimSpace(t)}}addText(t,e){let s=this.adaptor.value(e);(t.isToken||t.getProperty("isChars"))&&t.arity?(t.isToken&&(s=y(s),s=this.normalizeSpace(s)),t.appendChild(this.factory.create("text").setText(s))):s.match(/\S/)&&this.error('Unexpected text node "'+s+'"')}checkClass(t,e){const s=[];for(const a of this.filterClassList(this.adaptor.allClasses(e)))"MJX-"===a.substring(0,4)?"MJX-variant"===a?t.setProperty("variantForm",!0):"MJX-TeXAtom"!==a.substring(0,11)&&t.attributes.set("mathvariant",this.fixCalligraphic(a.substring(3))):s.push(a);s.length&&t.attributes.set("class",s.join(" "))}fixCalligraphic(t){return t.replace(/caligraphic/,"calligraphic")}markMrows(t){if(t.isKind("mrow")&&!t.isInferred&&2<=t.childNodes.length){const e=t.childNodes[0],s=t.childNodes[t.childNodes.length-1];e.isKind("mo")&&e.attributes.get("fence")&&e.attributes.get("stretchy")&&s.isKind("mo")&&s.attributes.get("fence")&&s.attributes.get("stretchy")&&(e.childNodes.length&&t.setProperty("open",e.getText()),s.childNodes.length&&t.setProperty("close",s.getText()))}}normalizeSpace(t){return t.replace(/[\t\n\r]/g," ").replace(/  +/g," ")}trimSpace(t){let e=t.childNodes[0];e&&(e.isKind("text")&&e.setText(e.getText().replace(/^ +/,"")),(e=t.childNodes[t.childNodes.length-1]).isKind("text")&&e.setText(e.getText().replace(/ +$/,"")))}error(t){throw new Error(t)}}g.OPTIONS={MmlFactory:null,allowHtmlInTokenNodes:!1,fixMisplacedChildren:!0,verify:Object.assign({},b.verifyDefaults),translateEntities:!0};class N extends o{constructor(t={}){var[t,e,s]=d(t,u.OPTIONS,g.OPTIONS);super(t),this.findMathML=this.options.FindMathML||new u(e),this.mathml=this.options.MathMLCompile||new g(s),this.mmlFilters=new c(this.options.mmlFilters)}setAdaptor(t){super.setAdaptor(t),this.findMathML.adaptor=t,this.mathml.adaptor=t}setMmlFactory(t){super.setMmlFactory(t),this.mathml.setMmlFactory(t)}get processStrings(){return!1}compile(e,s){let a=e.start.node;if(!a||!e.end.node||this.options.forceReparse||"#text"===this.adaptor.kind(a)){let t=this.executeFilters(this.preFilters,e,s,(e.math||"<math></math>").trim());"html"===this.options.parseAs&&(t=`<html><head></head><body>${t}</body></html>`);var r=this.checkForErrors(this.adaptor.parse(t,"text/"+this.options.parseAs)),r=this.adaptor.body(r);1!==this.adaptor.childNodes(r).length&&this.error("MathML must consist of a single element"),a=this.adaptor.remove(this.adaptor.firstChild(r)),"math"!==this.adaptor.kind(a).replace(/^[a-z]+:/,"")&&this.error("MathML must be formed by a <math> element, not <"+this.adaptor.kind(a)+">")}a=this.executeFilters(this.mmlFilters,e,s,a);let t=this.mathml.compile(a);return t=this.executeFilters(this.postFilters,e,s,t),e.display="block"===t.attributes.get("display"),t}checkForErrors(t){var e=this.adaptor.tags(this.adaptor.body(t),"parsererror")[0];return e&&(""===this.adaptor.textContent(e)&&this.error("Error processing MathML"),this.options.parseError.call(this,e)),t}error(t){throw new Error(t)}findMath(t){return this.findMathML.findMath(t)}}N.NAME="MathML",N.OPTIONS=l({parseAs:"html",forceReparse:!1,mmlFilters:[],FindMathML:null,MathMLCompile:null,parseError:function(t){this.error(this.adaptor.textContent(t).replace(/\n.*/g,""))}},o.OPTIONS),MathJax.loader&&MathJax.loader.checkVersion("input/mml","4.0.0","input"),i({_:{input:{mathml_ts:s,mathml:{FindMathML:t,MathMLCompile:e}}}}),MathJax.loader&&MathJax.loader.pathFilters.add(t=>(t.name=t.name.replace(/\/util\/entities\/.*?\.js/,"/input/mml/entities.js"),!0)),MathJax.startup&&(MathJax.startup.registerConstructor("mml",N),MathJax.startup.useInput("mml"))})();